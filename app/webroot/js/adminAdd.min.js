+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.toggle"),options="object"==typeof option&&option;data||$this.data("bs.toggle",data=new Toggle(this,options)),"string"==typeof option&&data[option]&&data[option]()})}var Toggle=function(element,options){this.$element=$(element),this.options=$.extend({},this.defaults(),options),this.render()};Toggle.VERSION="2.2.0",Toggle.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:"",width:null,height:null},Toggle.prototype.defaults=function(){return{on:this.$element.attr("data-on")||Toggle.DEFAULTS.on,off:this.$element.attr("data-off")||Toggle.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||Toggle.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||Toggle.DEFAULTS.offstyle,size:this.$element.attr("data-size")||Toggle.DEFAULTS.size,style:this.$element.attr("data-style")||Toggle.DEFAULTS.style,width:this.$element.attr("data-width")||Toggle.DEFAULTS.width,height:this.$element.attr("data-height")||Toggle.DEFAULTS.height}},Toggle.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var size="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",$toggleOn=$('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+size),$toggleOff=$('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+size+" active"),$toggleHandle=$('<span class="toggle-handle btn btn-default">').addClass(size),$toggleGroup=$('<div class="toggle-group">').append($toggleOn,$toggleOff,$toggleHandle),$toggle=$('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(size).addClass(this.options.style);this.$element.wrap($toggle),$.extend(this,{$toggle:this.$element.parent(),$toggleOn:$toggleOn,$toggleOff:$toggleOff,$toggleGroup:$toggleGroup}),this.$toggle.append($toggleGroup);var width=this.options.width||Math.max($toggleOn.outerWidth(),$toggleOff.outerWidth())+$toggleHandle.outerWidth()/2,height=this.options.height||Math.max($toggleOn.outerHeight(),$toggleOff.outerHeight());$toggleOn.addClass("toggle-on"),$toggleOff.addClass("toggle-off"),this.$toggle.css({width:width,height:height}),this.options.height&&($toggleOn.css("line-height",$toggleOn.height()+"px"),$toggleOff.css("line-height",$toggleOff.height()+"px")),this.update(!0),this.trigger(!0)},Toggle.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},Toggle.prototype.on=function(silent){if(this.$element.prop("disabled"))return!1;this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),silent||this.trigger()},Toggle.prototype.off=function(silent){if(this.$element.prop("disabled"))return!1;this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),silent||this.trigger()},Toggle.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},Toggle.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},Toggle.prototype.update=function(silent){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(silent):this.off(silent)},Toggle.prototype.trigger=function(silent){this.$element.off("change.bs.toggle"),silent||this.$element.change(),this.$element.on("change.bs.toggle",$.proxy(function(){this.update()},this))},Toggle.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var old=$.fn.bootstrapToggle;$.fn.bootstrapToggle=Plugin,$.fn.bootstrapToggle.Constructor=Toggle,$.fn.toggle.noConflict=function(){return $.fn.bootstrapToggle=old,this},$(function(){$("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),$(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(e){$(this).find("input[type=checkbox]").bootstrapToggle("toggle"),e.preventDefault()})}(jQuery),function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}(function($){"use strict";$.fn.fileinputLocales={},$.fn.fileinputThemes={};var $h,FileInput;$h={NAMESPACE:".fileinput",MODAL_ID:"kvFileinputModal",FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",STYLE_SETTING:'style="width:{width};height:{height};"',OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',objUrl:window.URL||window.webkitURL,compare:function(input,str,exact){return void 0!==input&&(exact?input===str:input.match(str))},handler:function($el,event,callback,skipNS){var ev=skipNS?event:event.split(" ").join($h.NAMESPACE+" ")+$h.NAMESPACE;$el.length&&$el.off(ev).on(ev,callback)},isIE:function(ver){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===ver)return new RegExp("msie\\s"+ver,"i").test(navigator.userAgent);var status,div=document.createElement("div");return div.innerHTML="<!--[if IE "+ver+"]> <i></i> <![endif]-->",status=div.getElementsByTagName("i").length,document.body.appendChild(div),div.parentNode.removeChild(div),status},isEmpty:function(value,trim){return void 0===value||null===value||0===value.length||trim&&""===$.trim(value)},isArray:function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},ifSet:function(needle,haystack,def){return def=def||"",haystack&&"object"==typeof haystack&&needle in haystack?haystack[needle]:def},getNum:function(num,def){return def=def||0,"number"==typeof num?num:("string"==typeof num&&(num=parseFloat(num)),isNaN(num)?def:num)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var div=document.createElement("div");return!$h.isIE(9)&&(void 0!==div.draggable||void 0!==div.ondragstart&&void 0!==div.ondrop)},hasFileUploadSupport:function(){return $h.hasFileAPISupport()&&window.FormData},addCss:function($el,css){$el.removeClass(css).addClass(css)},getElement:function(options,param,value){return $h.isEmpty(options)||$h.isEmpty(options[param])?value:$(options[param])},uniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode:function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(str,tags){var out=str;return tags?($.each(tags,function(key,value){"function"==typeof value&&(value=value()),out=out.split(key).join(value)}),out):out},cleanMemory:function($thumb){var data=$thumb.is("img")?$thumb.attr("src"):$thumb.find("source").attr("src");$h.objUrl.revokeObjectURL(data)},findFileName:function(filePath){var sepIndex=filePath.lastIndexOf("/");return sepIndex===-1&&(sepIndex=filePath.lastIndexOf("\\")),filePath.split(filePath.substring(sepIndex,sepIndex+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(maximize){var doc=document,de=doc.documentElement;de&&maximize&&!$h.checkFullScreen()?de.requestFullscreen?de.requestFullscreen():de.msRequestFullscreen?de.msRequestFullscreen():de.mozRequestFullScreen?de.mozRequestFullScreen():de.webkitRequestFullscreen&&de.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):doc.exitFullscreen?doc.exitFullscreen():doc.msExitFullscreen?doc.msExitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen&&doc.webkitExitFullscreen()},moveArray:function(arr,oldIndex,newIndex){if(newIndex>=arr.length)for(var k=newIndex-arr.length;1+k--;)arr.push(void 0);return arr.splice(newIndex,0,arr.splice(oldIndex,1)[0]),arr},cleanZoomCache:function($el){var $cache=$el.closest(".kv-zoom-cache-theme");$cache.length||($cache=$el.closest(".kv-zoom-cache")),$cache.remove()}},FileInput=function(element,options){var self=this;self.$element=$(element),self._validate()&&(self.isPreviewable=$h.hasFileAPISupport(),self.isIE9=$h.isIE(9),self.isIE10=$h.isIE(10),self.isPreviewable||self.isIE9?(self._init(options),self._listen()):self.$element.removeClass("file-loading"))},FileInput.prototype={constructor:FileInput,_init:function(options){var t,self=this,$el=self.$element;self.options=options,$.each(options,function(key,value){switch(key){case"minFileCount":case"maxFileCount":case"maxFileSize":self[key]=$h.getNum(value);break;default:self[key]=value}}),self._initTemplateDefaults(),self.fileInputCleared=!1,self.fileBatchCompleted=!0,self.isPreviewable||(self.showPreview=!1),self.uploadFileAttr=$h.isEmpty($el.attr("name"))?"file_data":$el.attr("name"),self.reader=null,self.formdata={},self.clearStack(),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.ajaxRequests=[],self.isError=!1,self.ajaxAborted=!1,self.cancelling=!1,t=self._getLayoutTemplate("progress"),self.progressTemplate=t.replace("{class}",self.progressClass),self.progressCompleteTemplate=t.replace("{class}",self.progressCompleteClass),self.progressErrorTemplate=t.replace("{class}",self.progressErrorClass),self.dropZoneEnabled=$h.hasDragDropSupport()&&self.dropZoneEnabled,self.isDisabled=self.$element.attr("disabled")||self.$element.attr("readonly"),self.isUploadable=$h.hasFileUploadSupport()&&!$h.isEmpty(self.uploadUrl),self.isClickable=self.browseOnZoneClick&&self.showPreview&&(self.isUploadable&&self.dropZoneEnabled||!$h.isEmpty(self.defaultPreviewContent)),self.slug="function"==typeof options.slugCallback?options.slugCallback:self._slugDefault,self.mainTemplate=self.showCaption?self._getLayoutTemplate("main1"):self._getLayoutTemplate("main2"),self.captionTemplate=self._getLayoutTemplate("caption"),self.previewGenericTemplate=self._getPreviewTemplate("generic"),self.resizeImage&&(self.maxImageWidth||self.maxImageHeight)&&(self.imageCanvas=document.createElement("canvas"),self.imageCanvasContext=self.imageCanvas.getContext("2d")),$h.isEmpty(self.$element.attr("id"))&&self.$element.attr("id",$h.uniqId()),void 0===self.$container?self.$container=self._createContainer():self._refreshContainer(),self.$dropZone=self.$container.find(".file-drop-zone"),self.$progress=self.$container.find(".kv-upload-progress"),self.$btnUpload=self.$container.find(".fileinput-upload"),self.$captionContainer=$h.getElement(options,"elCaptionContainer",self.$container.find(".file-caption")),self.$caption=$h.getElement(options,"elCaptionText",self.$container.find(".file-caption-name")),self.$previewContainer=$h.getElement(options,"elPreviewContainer",self.$container.find(".file-preview")),self.$preview=$h.getElement(options,"elPreviewImage",self.$container.find(".file-preview-thumbnails")),self.$previewStatus=$h.getElement(options,"elPreviewStatus",self.$container.find(".file-preview-status")),self.$errorContainer=$h.getElement(options,"elErrorContainer",self.$previewContainer.find(".kv-fileinput-error")),$h.isEmpty(self.msgErrorClass)||$h.addCss(self.$errorContainer,self.msgErrorClass),self.$errorContainer.hide(),self.previewInitId="preview-"+$h.uniqId(),self._initPreviewCache(),self._initPreview(!0),self._initPreviewActions(),self._setFileDropZoneTitle(),self.$element.removeClass("file-loading"),self.$element.attr("disabled")&&self.disable(),self._initZoom()},_initTemplateDefaults:function(){var tMain1,tMain2,tPreview,tFileIcon,tClose,tCaption,tBtnDefault,tBtnLink,tBtnBrowse,tModalMain,tModal,tProgress,tSize,tFooter,tActions,tActionDelete,tActionUpload,tActionZoom,tActionDrag,tTagBef,tTagBef1,tTagBef2,tTagAft,tGeneric,tHtml,tImage,tText,tVideo,tAudio,tFlash,tObject,tPdf,tOther,tZoomCache,self=this;tMain1='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',tMain2='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',tPreview='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',tClose='<div class="close fileinput-remove">&times;</div>\n',tFileIcon='<i class="glyphicon glyphicon-file kv-caption-icon"></i>',tCaption='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',tBtnDefault='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',tBtnLink='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',tBtnBrowse='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',tModalMain='<div id="'+$h.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+$h.MODAL_ID+'Label"></div>',tModal='<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}</div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h3>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',tProgress='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',tSize=" <samp>({sizeText})</samp>",tFooter='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}<br>{size}</div>\n    {progress} {actions}\n</div>',tActions='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    </div>\n    <div class="clearfix"></div>\n</div>',tActionDelete='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',tActionUpload='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',tActionZoom='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',tActionDrag='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',tTagBef='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"',tTagBef1=tTagBef+'><div class="kv-file-content">\n',tTagBef2=tTagBef+' title="{caption}"><div class="kv-file-content">\n',tTagAft="</div>{footer}\n</div>\n",tGeneric="{content}\n",tHtml='<div class="kv-preview-data file-preview-html" title="{caption}" '+$h.STYLE_SETTING+">{data}</div>\n",tImage='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" '+$h.STYLE_SETTING+">\n",tText='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+$h.STYLE_SETTING+">{data}</textarea>\n",tVideo='<video class="kv-preview-data file-preview-video" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+$h.DEFAULT_PREVIEW+"\n</video>\n",tAudio='<div class="file-preview-audio"><audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+$h.DEFAULT_PREVIEW+"\n</audio></div>\n",tFlash='<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+$h.OBJECT_PARAMS+" "+$h.DEFAULT_PREVIEW+"\n</object>\n",tObject='<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+$h.OBJECT_PARAMS+" "+$h.DEFAULT_PREVIEW+"\n</object>\n",tPdf='<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n',tOther='<div class="kv-preview-data file-preview-other-frame">\n'+$h.DEFAULT_PREVIEW+"\n</div>\n",tZoomCache='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>',self.defaults={layoutTemplates:{main1:tMain1,main2:tMain2,preview:tPreview,close:tClose,fileIcon:tFileIcon,caption:tCaption,modalMain:tModalMain,modal:tModal,progress:tProgress,size:tSize,footer:tFooter,actions:tActions,actionDelete:tActionDelete,actionUpload:tActionUpload,actionZoom:tActionZoom,actionDrag:tActionDrag,btnDefault:tBtnDefault,btnLink:tBtnLink,btnBrowse:tBtnBrowse,zoomCache:tZoomCache},previewMarkupTags:{tagBefore1:tTagBef1,tagBefore2:tTagBef2,tagAfter:tTagAft},previewContentTemplates:{generic:tGeneric,html:tHtml,image:tImage,text:tText,video:tVideo,audio:tAudio,flash:tFlash,object:tObject,pdf:tPdf,other:tOther},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"auto"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","min-height":"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(vType,vName){return $h.compare(vType,"image.*")||$h.compare(vName,/\.(gif|png|jpe?g)$/i)},html:function(vType,vName){return $h.compare(vType,"text/html")||$h.compare(vName,/\.(htm|html)$/i)},text:function(vType,vName){return $h.compare(vType,"text.*")||$h.compare(vName,/\.(xml|javascript)$/i)||$h.compare(vName,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(vType,vName){return $h.compare(vType,"video.*")&&($h.compare(vType,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||$h.compare(vName,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(vType,vName){return $h.compare(vType,"audio.*")&&($h.compare(vName,/(ogg|mp3|mp?g|wav)$/i)||$h.compare(vName,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(vType,vName){return $h.compare(vType,"application/x-shockwave-flash",!0)||$h.compare(vName,/\.(swf)$/i)},pdf:function(vType,vName){return $h.compare(vType,"application/pdf",!0)||$h.compare(vName,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},$.each(self.defaults,function(key,setting){if("allowedPreviewTypes"===key)return void(void 0===self.allowedPreviewTypes&&(self.allowedPreviewTypes=setting));self[key]=$.extend(!0,{},setting,self[key])}),self._initPreviewTemplates()},_initPreviewTemplates:function(){var tagBef,self=this,cfg=self.defaults,tags=self.previewMarkupTags,tagAft=tags.tagAfter;$.each(cfg.previewContentTemplates,function(key,value){$h.isEmpty(self.previewTemplates[key])&&(tagBef=tags.tagBefore2,"generic"!==key&&"image"!==key&&"html"!==key&&"text"!==key||(tagBef=tags.tagBefore1),self.previewTemplates[key]=tagBef+value+tagAft)})},_initPreviewCache:function(){var self=this;self.previewCache={data:{},init:function(){var content=self.initialPreview;content.length>0&&!$h.isArray(content)&&(content=content.split(self.initialPreviewDelimiter)),self.previewCache.data={content:content,config:self.initialPreviewConfig,tags:self.initialPreviewThumbTags}},fetch:function(){return self.previewCache.data.content.filter(function(n){return null!==n})},count:function(all){return self.previewCache.data&&self.previewCache.data.content?all?self.previewCache.data.content.length:self.previewCache.fetch().length:0},get:function(i,isDisabled){var out,$tmp,cat,ftr,fname,ftype,frameClass,ind="init_"+i,data=self.previewCache.data,config=data.config[i],content=data.content[i],previewId=self.previewInitId+"-"+ind,asData=$h.ifSet("previewAsData",config,self.initialPreviewAsData),parseTemplate=function(cat,dat,fn,ft,id,ftr,ind,fc,t){return fc=" file-preview-initial "+$h.SORT_CSS+(fc?" "+fc:""),self._generatePreviewTemplate(cat,dat,fn,ft,id,!1,null,fc,ftr,ind,t)};return content?(isDisabled=void 0===isDisabled||isDisabled,cat=$h.ifSet("type",config,self.initialPreviewFileType||"generic"),fname=$h.ifSet("filename",config,$h.ifSet("caption",config)),ftype=$h.ifSet("filetype",config,cat),ftr=self.previewCache.footer(i,isDisabled,config&&config.size||null),frameClass=$h.ifSet("frameClass",config),out=asData?parseTemplate(cat,content,fname,ftype,previewId,ftr,ind,frameClass):parseTemplate("generic",content,fname,ftype,previewId,ftr,ind,frameClass,cat).replace(/\{content}/g,data.content[i]),data.tags.length&&data.tags[i]&&(out=$h.replaceTags(out,data.tags[i])),$h.isEmpty(config)||$h.isEmpty(config.frameAttr)||($tmp=$(document.createElement("div")).html(out),$tmp.find(".file-preview-initial").attr(config.frameAttr),out=$tmp.html(),$tmp.remove()),out):""},add:function(content,config,tags,append){var index,data=self.previewCache.data;return $h.isArray(content)||(content=content.split(self.initialPreviewDelimiter)),append?(index=data.content.push(content)-1,data.config[index]=config,data.tags[index]=tags):(index=content.length-1,data.content=content,data.config=config,data.tags=tags),self.previewCache.data=data,index},set:function(content,config,tags,append){var i,chk,data=self.previewCache.data;if(content&&content.length&&($h.isArray(content)||(content=content.split(self.initialPreviewDelimiter)),chk=content.filter(function(n){return null!==n}),chk.length)){if(void 0===data.content&&(data.content=[]),void 0===data.config&&(data.config=[]),void 0===data.tags&&(data.tags=[]),append){for(i=0;i<content.length;i++)content[i]&&data.content.push(content[i]);for(i=0;i<config.length;i++)config[i]&&data.config.push(config[i]);for(i=0;i<tags.length;i++)tags[i]&&data.tags.push(tags[i])}else data.content=content,data.config=config,data.tags=tags;self.previewCache.data=data}},unset:function(index){var chk=self.previewCache.count();if(chk){if(1===chk)return self.previewCache.data.content=[],self.previewCache.data.config=[],self.previewCache.data.tags=[],self.initialPreview=[],self.initialPreviewConfig=[],void(self.initialPreviewThumbTags=[]);self.previewCache.data.content[index]=null,self.previewCache.data.config[index]=null,self.previewCache.data.tags[index]=null}},out:function(){var caption,i,html="",len=self.previewCache.count(!0);if(0===len)return{content:"",caption:""};for(i=0;i<len;i++)html+=self.previewCache.get(i);return caption=self._getMsgSelected(self.previewCache.count()),{content:html,caption:caption}},footer:function(i,isDisabled,size){var data=self.previewCache.data;if(!data||!data.config||0===data.config.length||$h.isEmpty(data.config[i]))return"";isDisabled=void 0===isDisabled||isDisabled;var config=data.config[i],caption=$h.ifSet("caption",config),actions="",width=$h.ifSet("width",config,"auto"),url=$h.ifSet("url",config,!1),key=$h.ifSet("key",config,null),fs=self.fileActionSettings,showDel=$h.ifSet("showDelete",config,!0),showZoom=$h.ifSet("showZoom",config,fs.showZoom),showDrag=$h.ifSet("showDrag",config,fs.showDrag),disabled=url===!1&&isDisabled;return self.initialPreviewShowDelete&&(actions=self._renderFileActions(!1,showDel,showZoom,showDrag,disabled,url,key,!0)),self._getLayoutTemplate("footer").replace(/\{progress}/g,self._renderThumbProgress()).replace(/\{actions}/g,actions).replace(/\{caption}/g,caption).replace(/\{size}/g,self._getSize(size)).replace(/\{width}/g,width).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}},self.previewCache.init()},_log:function(msg){var self=this,id=self.$element.attr("id");id&&(msg='"'+id+'": '+msg),void 0!==window.console.log?window.console.log(msg):window.alert(msg)},_validate:function(){var self=this,status="file"===self.$element.attr("type");return status||self._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),status},_errorsExist:function(){var $err,self=this;return!!self.$errorContainer.find("li").length||($err=$(document.createElement("div")).html(self.$errorContainer.html()),$err.find("span.kv-error-close").remove(),$err.find("ul").remove(),!!$.trim($err.text()).length)},_errorHandler:function(evt,caption){var self=this,err=evt.target.error;err.code===err.NOT_FOUND_ERR?self._showError(self.msgFileNotFound.replace("{name}",caption)):err.code===err.SECURITY_ERR?self._showError(self.msgFileSecured.replace("{name}",caption)):err.code===err.NOT_READABLE_ERR?self._showError(self.msgFileNotReadable.replace("{name}",caption)):err.code===err.ABORT_ERR?self._showError(self.msgFilePreviewAborted.replace("{name}",caption)):self._showError(self.msgFilePreviewError.replace("{name}",caption))},_addError:function(msg){var self=this,$error=self.$errorContainer;msg&&$error.length&&($error.html(self.errorCloseButton+msg),$h.handler($error.find(".kv-error-close"),"click",function(){$error.fadeOut("slow")}))},_resetErrors:function(fade){var self=this,$error=self.$errorContainer;self.isError=!1,self.$container.removeClass("has-error"),$error.html(""),fade?$error.fadeOut("slow"):$error.hide()},_showFolderError:function(folders){var msg,self=this,$error=self.$errorContainer;folders&&(msg=self.msgFoldersNotAllowed.replace(/\{n}/g,folders),self._addError(msg),$h.addCss(self.$container,"has-error"),$error.fadeIn(800),self._raise("filefoldererror",[folders,msg]))},_showUploadError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileuploaderror",e=params&&params.id?'<li data-file-id="'+params.id+'">'+msg+"</li>":"<li>"+msg+"</li>";return 0===$error.find("ul").length?self._addError("<ul>"+e+"</ul>"):$error.find("ul").append(e),$error.fadeIn(800),self._raise(ev,[params,msg]),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"has-error"),!0},_showError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileerror";return params=params||{},params.reader=self.reader,self._addError(msg),$error.fadeIn(800),self._raise(ev,[params,msg]),self.isUploadable||self._clearFileInput(),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"has-error"),self.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(params){var self=this,label=self.minFileCount>1?self.filePlural:self.fileSingle,msg=self.msgFilesTooLess.replace("{n}",self.minFileCount).replace("{files}",label),$error=self.$errorContainer;self._addError(msg),self.isError=!0,self._updateFileDetails(0),$error.fadeIn(800),self._raise("fileerror",[params,msg]),self._clearFileInput(),$h.addCss(self.$container,"has-error")},_parseError:function(operation,jqXHR,errorThrown,fileName){var self=this,errMsg=$.trim(errorThrown+""),dot="."===errMsg.slice(-1)?"":".",text=void 0!==jqXHR.responseJSON&&void 0!==jqXHR.responseJSON.error?jqXHR.responseJSON.error:jqXHR.responseText;return self.cancelling&&self.msgUploadAborted&&(errMsg=self.msgUploadAborted),self.showAjaxErrorDetails&&text?(text=$.trim(text.replace(/\n\s*\n/g,"\n")),text=text.length>0?"<pre>"+text+"</pre>":"",errMsg+=dot+text):errMsg+=dot,errMsg===dot&&(errMsg=self.msgAjaxError.replace("{operation}",operation)),self.cancelling=!1,fileName?"<b>"+fileName+": </b>"+errMsg:errMsg},_parseFileType:function(file){var isValid,vType,cat,i,self=this,types=self.allowedPreviewTypes;for(i=0;i<types.length;i++)if(cat=types[i],isValid=self.fileTypeSettings[cat],vType=isValid(file.type,file.name)?cat:"",!$h.isEmpty(vType))return vType;return"other"},_getPreviewIcon:function(fname){var ext,self=this,out=null;return fname&&fname.indexOf(".")>-1&&(ext=fname.split(".").pop(),self.previewFileIconSettings&&self.previewFileIconSettings[ext]&&(out=self.previewFileIconSettings[ext]),self.previewFileExtSettings&&$.each(self.previewFileExtSettings,function(key,func){if(self.previewFileIconSettings[key]&&func(ext))return void(out=self.previewFileIconSettings[key])})),out},_parseFilePreviewIcon:function(content,fname){var self=this,icn=self._getPreviewIcon(fname)||self.previewFileIcon;return content.indexOf("{previewFileIcon}")>-1&&(content=content.replace(/\{previewFileIconClass}/g,self.previewFileIconClass).replace(/\{previewFileIcon}/g,icn)),content},_raise:function(event,params){var self=this,e=$.Event(event);if(void 0!==params?self.$element.trigger(e,params):self.$element.trigger(e),e.isDefaultPrevented())return!1;if(!e.result)return e.result;switch(event){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:self.ajaxAborted=e.result}return!0},_listenFullScreen:function(isFullScreen){var $btnFull,$btnBord,self=this,$modal=self.$modal;$modal&&$modal.length&&($btnFull=$modal&&$modal.find(".btn-fullscreen"),$btnBord=$modal&&$modal.find(".btn-borderless"),$btnFull.length&&$btnBord.length&&($btnFull.removeClass("active").attr("aria-pressed","false"),$btnBord.removeClass("active").attr("aria-pressed","false"),isFullScreen?$btnFull.addClass("active").attr("aria-pressed","true"):$btnBord.addClass("active").attr("aria-pressed","true"),$modal.hasClass("file-zoom-fullscreen")?self._maximizeZoomDialog():isFullScreen?self._maximizeZoomDialog():$btnBord.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var self=this,$el=self.$element,$form=$el.closest("form"),$cont=self.$container;$h.handler($el,"change",$.proxy(self._change,self)),self.showBrowse&&$h.handler(self.$btnFile,"click",$.proxy(self._browse,self)),$h.handler($form,"reset",$.proxy(self.reset,self)),$h.handler($cont.find(".fileinput-remove:not([disabled])"),"click",$.proxy(self.clear,self)),$h.handler($cont.find(".fileinput-cancel"),"click",$.proxy(self.cancel,self)),self._initDragDrop(),self.isUploadable||$h.handler($form,"submit",$.proxy(self._submitForm,self)),
$h.handler(self.$container.find(".fileinput-upload"),"click",$.proxy(self._uploadClick,self)),$h.handler($(window),"resize",function(){self._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),$h.handler($(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){self._listenFullScreen($h.checkFullScreen())}),self._initClickable()},_initClickable:function(){var $zone,self=this;self.isClickable&&($zone=self.isUploadable?self.$dropZone:self.$preview.find(".file-default-preview"),$h.addCss($zone,"clickable"),$zone.attr("tabindex",-1),$h.handler($zone,"click",function(e){var $tar=$(e.target);$tar.parents(".file-preview-thumbnails").length&&!$tar.parents(".file-default-preview").length||(self.$element.trigger("click"),$zone.blur())}))},_initDragDrop:function(){var self=this,$zone=self.$dropZone;self.isUploadable&&self.dropZoneEnabled&&self.showPreview&&($h.handler($zone,"dragenter dragover",$.proxy(self._zoneDragEnter,self)),$h.handler($zone,"dragleave",$.proxy(self._zoneDragLeave,self)),$h.handler($zone,"drop",$.proxy(self._zoneDrop,self)),$h.handler($(document),"dragenter dragover drop",self._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var self=this,hasFiles=$.inArray("Files",e.originalEvent.dataTransfer.types)>-1;if(self._zoneDragDropInit(e),self.isDisabled||!hasFiles)return e.originalEvent.dataTransfer.effectAllowed="none",void(e.originalEvent.dataTransfer.dropEffect="none");$h.addCss(self.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var self=this;self._zoneDragDropInit(e),self.isDisabled||self.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var self=this;e.preventDefault(),self.isDisabled||$h.isEmpty(e.originalEvent.dataTransfer.files)||(self._change(e,"dragdrop"),self.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(e){var $form,self=this,$btn=self.$container.find(".fileinput-upload"),isEnabled=!$btn.hasClass("disabled")&&$h.isEmpty($btn.attr("disabled"));if(!e||!e.isDefaultPrevented()){if(!self.isUploadable)return void(isEnabled&&"submit"!==$btn.attr("type")&&($form=$btn.closest("form"),$form.length&&$form.trigger("submit"),e.preventDefault()));e.preventDefault(),isEnabled&&self.upload()}},_submitForm:function(){var self=this,$el=self.$element,files=$el.get(0).files;return files&&self.minFileCount>0&&self._getFileCount(files.length)<self.minFileCount?(self._noFilesError({}),!1):!self._abort({})},_clearPreview:function(){var self=this,$p=self.$preview;(self.showUploadedThumbs?$p.find($h.FRAMES+":not(.file-preview-success)"):$p.find($h.FRAMES)).each(function(){var $thumb=$(this);$thumb.remove(),$h.cleanZoomCache($p.find("#zoom-"+$thumb.attr("id")))}),self.$preview.find($h.FRAMES).length&&self.showPreview||self._resetUpload(),self._validateDefaultPreview()},_initSortable:function(){var settings,self=this,$el=self.$preview,selector="."+$h.SORT_CSS;window.KvSortable&&0!==$el.find(selector).length&&(settings={handle:".drag-handle-init",dataIdAttr:"data-preview-id",draggable:selector,onSort:function(e){var key,$frame,oldIndex=e.oldIndex,newIndex=e.newIndex;self.initialPreview=$h.moveArray(self.initialPreview,oldIndex,newIndex),self.initialPreviewConfig=$h.moveArray(self.initialPreviewConfig,oldIndex,newIndex),self.previewCache.init();for(var i=0;i<self.initialPreviewConfig.length;i++)null!==self.initialPreviewConfig[i]&&(key=self.initialPreviewConfig[i].key,$frame=$(".kv-file-remove[data-key='"+key+"']").closest($h.FRAMES),$frame.attr("data-fileindex","init_"+i).data("fileindex","init_"+i));self._raise("filesorted",{previewId:$(e.item).attr("id"),oldIndex:oldIndex,newIndex:newIndex,stack:self.initialPreviewConfig})}},$el.data("kvsortable")&&$el.kvsortable("destroy"),$.extend(!0,settings,self.fileActionSettings.dragSettings),$el.kvsortable(settings))},_initPreview:function(isInit){var out,self=this,cap=self.initialCaption||"";if(!self.previewCache.count())return self._clearPreview(),void(isInit?self._setCaption(cap):self._initCaption());out=self.previewCache.out(),cap=isInit&&self.initialCaption?self.initialCaption:out.caption,self.$preview.html(out.content),self._setInitThumbAttr(),self._setCaption(cap),self._initSortable(),$h.isEmpty(out.content)||self.$container.removeClass("file-input-new")},_getZoomButton:function(type){var self=this,label=self.previewZoomButtonIcons[type],css=self.previewZoomButtonClasses[type],title=' title="'+(self.previewZoomButtonTitles[type]||"")+'" ',params=title+("close"===type?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==type&&"borderless"!==type&&"toggleheader"!==type||(params+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+css+" btn-"+type+'"'+params+">"+label+"</button>"},_getModalContent:function(){var self=this;return self._getLayoutTemplate("modal").replace(/\{heading}/g,self.msgZoomModalHeading).replace(/\{prev}/g,self._getZoomButton("prev")).replace(/\{next}/g,self._getZoomButton("next")).replace(/\{toggleheader}/g,self._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,self._getZoomButton("fullscreen")).replace(/\{borderless}/g,self._getZoomButton("borderless")).replace(/\{close}/g,self._getZoomButton("close"))},_listenModalEvent:function(event){var self=this,$modal=self.$modal,getParams=function(e){return{sourceEvent:e,previewId:$modal.data("previewId"),modal:$modal}};$modal.on(event+".bs.modal",function(e){var $btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless");self._raise("filezoom"+event,getParams(e)),"shown"===event&&($btnBord.removeClass("active").attr("aria-pressed","false"),$btnFull.removeClass("active").attr("aria-pressed","false"),$modal.hasClass("file-zoom-fullscreen")&&(self._maximizeZoomDialog(),$h.checkFullScreen()?$btnFull.addClass("active").attr("aria-pressed","true"):$btnBord.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var $dialog,self=this,modalMain=self._getLayoutTemplate("modalMain"),modalId="#"+$h.MODAL_ID;self.$modal=$(modalId),self.$modal&&self.$modal.length||($dialog=$(document.createElement("div")).html(modalMain).insertAfter(self.$container),self.$modal=$("#"+$h.MODAL_ID).insertBefore($dialog),$dialog.remove()),self.$modal.html(self._getModalContent()),self._listenModalEvent("show"),self._listenModalEvent("shown"),self._listenModalEvent("hide"),self._listenModalEvent("hidden"),self._listenModalEvent("loaded")},_initZoomButtons:function(){var $first,$last,self=this,previewId=self.$modal.data("previewId")||"",$preview=self.$preview,thumbs=$preview.find($h.FRAMES).toArray(),len=thumbs.length,$prev=self.$modal.find(".btn-prev"),$next=self.$modal.find(".btn-next");if(thumbs.length<2)return $prev.hide(),void $next.hide();$prev.show(),$next.show(),len&&($first=$(thumbs[0]),$last=$(thumbs[len-1]),$prev.removeAttr("disabled"),$next.removeAttr("disabled"),$first.length&&$first.attr("id")===previewId&&$prev.attr("disabled",!0),$last.length&&$last.attr("id")===previewId&&$next.attr("disabled",!0))},_maximizeZoomDialog:function(){var self=this,$modal=self.$modal,$head=$modal.find(".modal-header:visible"),$foot=$modal.find(".modal-footer:visible"),$body=$modal.find(".modal-body"),h=$(window).height(),diff=0;$modal.addClass("file-zoom-fullscreen"),$head&&$head.length&&(h-=$head.outerHeight(!0)),$foot&&$foot.length&&(h-=$foot.outerHeight(!0)),$body&&$body.length&&(diff=$body.outerHeight(!0)-$body.height(),h-=diff),$modal.find(".kv-zoom-body").height(h)},_resizeZoomDialog:function(fullScreen){var self=this,$modal=self.$modal,$btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless");if($modal.hasClass("file-zoom-fullscreen"))$h.toggleFullScreen(!1),fullScreen?$btnFull.hasClass("active")||($modal.removeClass("file-zoom-fullscreen"),self._resizeZoomDialog(!0),$btnBord.hasClass("active")&&$btnBord.removeClass("active").attr("aria-pressed","false")):$btnFull.hasClass("active")?$btnFull.removeClass("active").attr("aria-pressed","false"):($modal.removeClass("file-zoom-fullscreen"),self.$modal.find(".kv-zoom-body").css("height",self.zoomModalHeight));else{if(!fullScreen)return void self._maximizeZoomDialog();$h.toggleFullScreen(!0)}$modal.focus()},_setZoomContent:function($frame,animate){var $content,tmplt,body,title,$body,$dataEl,config,$tmp,cap,size,self=this,pid=$frame.attr("id"),$modal=self.$modal,$prev=$modal.find(".btn-prev"),$next=$modal.find(".btn-next"),$btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless"),$btnTogh=$modal.find(".btn-toggleheader"),$zoomPreview=self.$preview.find("#zoom-"+pid);tmplt=$zoomPreview.attr("data-template")||"generic",$content=$zoomPreview.find(".kv-file-content"),body=$content.length?$content.html():"",cap=$frame.data("caption")||"",size=$frame.data("size")||"",title=cap+" "+size,$modal.find(".kv-zoom-title").html(title),$body=$modal.find(".kv-zoom-body"),$modal.removeClass("kv-single-content"),animate?($tmp=$body.clone().insertAfter($body),$body.html(body).hide(),$tmp.fadeOut("fast",function(){$body.fadeIn("fast"),$tmp.remove()})):$body.html(body),config=self.previewZoomSettings[tmplt],config&&($dataEl=$body.find(".kv-preview-data"),$h.addCss($dataEl,"file-zoom-detail"),$.each(config,function(key,value){$dataEl.css(key,value),($dataEl.attr("width")&&"width"===key||$dataEl.attr("height")&&"height"===key)&&$dataEl.removeAttr(key)})),$modal.data("previewId",pid),$h.handler($prev,"click",function(){self._zoomSlideShow("prev",pid)}),$h.handler($next,"click",function(){self._zoomSlideShow("next",pid)}),$h.handler($btnFull,"click",function(){self._resizeZoomDialog(!0)}),$h.handler($btnBord,"click",function(){self._resizeZoomDialog(!1)}),$h.handler($btnTogh,"click",function(){var ht,$header=$modal.find(".modal-header"),$floatBar=$modal.find(".modal-body .floating-buttons"),$actions=$header.find(".kv-zoom-actions"),resize=function(height){var $body=self.$modal.find(".kv-zoom-body"),h=self.zoomModalHeight;$modal.hasClass("file-zoom-fullscreen")&&(h=$body.outerHeight(!0),height||(h-=$header.outerHeight(!0))),$body.css("height",height?h+height:h)};$header.is(":visible")?(ht=$header.outerHeight(!0),$header.slideUp("slow",function(){$actions.find(".btn").appendTo($floatBar),resize(ht)})):($floatBar.find(".btn").appendTo($actions),$header.slideDown("slow",function(){resize()})),$modal.focus()}),$h.handler($modal,"keydown",function(e){var key=e.which||e.keyCode;37!==key||$prev.attr("disabled")||self._zoomSlideShow("prev",pid),39!==key||$next.attr("disabled")||self._zoomSlideShow("next",pid)})},_zoomPreview:function($btn){var $frame,self=this,$body=$("body"),$modal=self.$modal;if(!$btn.length)throw"Cannot zoom to detailed preview!";$body.length&&$modal.appendTo($body),$modal.html(self._getModalContent()),$frame=$btn.closest($h.FRAMES),self._setZoomContent($frame),$modal.modal("show"),self._initZoomButtons()},_zoomSlideShow:function(dir,previewId){var $targFrame,i,out,self=this,$btn=self.$modal.find(".kv-zoom-actions .btn-"+dir),thumbs=self.$preview.find($h.FRAMES).toArray(),len=thumbs.length;if(!$btn.attr("disabled")){for(i=0;i<len;i++)if($(thumbs[i]).attr("id")===previewId){out="prev"===dir?i-1:i+1;break}out<0||out>=len||!thumbs[out]||($targFrame=$(thumbs[out]),$targFrame.length&&self._setZoomContent($targFrame,!0),self._initZoomButtons(),self._raise("filezoom"+dir,{previewId:previewId,modal:self.$modal}))}},_initZoomButton:function(){var self=this;self.$preview.find(".kv-file-zoom").each(function(){var $el=$(this);$h.handler($el,"click",function(){self._zoomPreview($el)})})},_initPreviewActions:function(){var self=this,$preview=self.$preview,deleteExtraData=self.deleteExtraData||{},btnRemove=$h.FRAMES+" .kv-file-remove",resetProgress=function(){var hasFiles=self.isUploadable?self.previewCache.count():self.$element.get(0).files.length;0!==$preview.find(btnRemove).length||hasFiles||(self.reset(),self.initialCaption="")};self._initZoomButton(),$preview.find(btnRemove).each(function(){var $el=$(this),vUrl=$el.data("url")||self.deleteUrl,vKey=$el.data("key");if(!$h.isEmpty(vUrl)&&void 0!==vKey){var settings,params,config,extraData,$frame=$el.closest($h.FRAMES),cache=self.previewCache.data,index=$frame.data("fileindex");index=parseInt(index.replace("init_","")),config=$h.isEmpty(cache.config)&&$h.isEmpty(cache.config[index])?null:cache.config[index],extraData=$h.isEmpty(config)||$h.isEmpty(config.extra)?deleteExtraData:config.extra,"function"==typeof extraData&&(extraData=extraData()),params={id:$el.attr("id"),key:vKey,extra:extraData},settings=$.extend(!0,{},{url:vUrl,type:"POST",dataType:"json",data:$.extend(!0,{},{key:vKey},extraData),beforeSend:function(jqXHR){self.ajaxAborted=!1,self._raise("filepredelete",[vKey,jqXHR,extraData]),self.ajaxAborted?jqXHR.abort():($h.addCss($frame,"file-uploading"),$h.addCss($el,"disabled"))},success:function(data,textStatus,jqXHR){var n,cap;if(!$h.isEmpty(data)&&!$h.isEmpty(data.error))return params.jqXHR=jqXHR,params.response=data,self._showError(data.error,params,"filedeleteerror"),$frame.removeClass("file-uploading"),$el.removeClass("disabled"),void resetProgress();self.previewCache.init(),index=parseInt($frame.data("fileindex").replace("init_","")),self.previewCache.unset(index),n=self.previewCache.count(),cap=n>0?self._getMsgSelected(n):"",self._raise("filedeleted",[vKey,jqXHR,extraData]),self._setCaption(cap),$frame.removeClass("file-uploading").addClass("file-deleted"),$frame.fadeOut("slow",function(){$h.cleanZoomCache($preview.find("#zoom-"+$frame.attr("id"))),self._clearObjects($frame),$frame.remove(),resetProgress(),n||0!==self.getFileStack().length||(self._setCaption(""),self.reset())})},error:function(jqXHR,textStatus,errorThrown){var op=self.ajaxOperations.deleteThumb,errMsg=self._parseError(op,jqXHR,errorThrown);params.jqXHR=jqXHR,params.response={},self._showError(errMsg,params,"filedeleteerror"),$frame.removeClass("file-uploading"),resetProgress()}},self.ajaxDeleteSettings),$h.handler($el,"click",function(){if(!self._validateMinCount())return!1;$.ajax(settings)})}})},_clearObjects:function($el){$el.find("video audio").each(function(){this.pause(),$(this).remove()}),$el.find("img object div").each(function(){$(this).remove()})},_clearFileInput:function(){var $srcFrm,$tmpFrm,$tmpEl,self=this,$el=self.$element;self.fileInputCleared=!0,$h.isEmpty($el.val())||(self.isIE9||self.isIE10?($srcFrm=$el.closest("form"),$tmpFrm=$(document.createElement("form")),$tmpEl=$(document.createElement("div")),$el.before($tmpEl),$srcFrm.length?$srcFrm.after($tmpFrm):$tmpEl.after($tmpFrm),$tmpFrm.append($el).trigger("reset"),$tmpEl.before($el).remove(),$tmpFrm.remove()):$el.val(""))},_resetUpload:function(){var self=this;self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.$btnUpload.removeAttr("disabled"),self._setProgress(0),$h.addCss(self.$progress,"hide"),self._resetErrors(!1),self.ajaxAborted=!1,self.ajaxRequests=[],self._resetCanvas(),self.cacheInitialPreview={}},_resetCanvas:function(){var self=this;self.canvas&&self.imageCanvasContext&&self.imageCanvasContext.clearRect(0,0,self.canvas.width,self.canvas.height)},_hasInitialPreview:function(){var self=this;return!self.overwriteInitial&&self.previewCache.count()},_resetPreview:function(){var out,cap,self=this;self.previewCache.count()?(out=self.previewCache.out(),self.$preview.html(out.content),self._setInitThumbAttr(),cap=self.initialCaption?self.initialCaption:out.caption,self._setCaption(cap)):(self._clearPreview(),self._initCaption()),self.showPreview&&(self._initZoom(),self._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var self=this;self.showPreview&&!$h.isEmpty(self.defaultPreviewContent)&&(self.$preview.html('<div class="file-default-preview">'+self.defaultPreviewContent+"</div>"),self.$container.removeClass("file-input-new"),self._initClickable())},_resetPreviewThumbs:function(isAjax){var out,self=this;if(isAjax)return self._clearPreview(),void self.clearStack();self._hasInitialPreview()?(out=self.previewCache.out(),self.$preview.html(out.content),self._setInitThumbAttr(),self._setCaption(out.caption),self._initPreviewActions()):self._clearPreview()},_getLayoutTemplate:function(t){var self=this,template=self.layoutTemplates[t];return $h.isEmpty(self.customLayoutTags)?template:$h.replaceTags(template,self.customLayoutTags)},_getPreviewTemplate:function(t){var self=this,template=self.previewTemplates[t];return $h.isEmpty(self.customPreviewTags)?template:$h.replaceTags(template,self.customPreviewTags)},_getOutData:function(jqXHR,responseData,filesData){var self=this;return jqXHR=jqXHR||{},responseData=responseData||{},filesData=filesData||self.filestack.slice(0)||{},{form:self.formdata,files:filesData,filenames:self.filenames,filescount:self.getFilesCount(),extra:self._getExtraData(),response:responseData,reader:self.reader,jqXHR:jqXHR}},_getMsgSelected:function(n){var self=this,strFiles=1===n?self.fileSingle:self.filePlural;return n>0?self.msgSelected.replace("{n}",n).replace("{files}",strFiles):self.msgNoFilesSelected},_getThumbs:function(css){return css=css||"",this.$preview.find($h.FRAMES+":not(.file-preview-initial)"+css)},_getExtraData:function(previewId,index){var self=this,data=self.uploadExtraData;return"function"==typeof self.uploadExtraData&&(data=self.uploadExtraData(previewId,index)),data},_initXhr:function(xhrobj,previewId,fileCount){var self=this;return xhrobj.upload&&xhrobj.upload.addEventListener("progress",function(event){var pct=0,total=event.total,position=event.loaded||event.position;event.lengthComputable&&(pct=Math.floor(position/total*100)),previewId?self._setAsyncUploadStatus(previewId,pct,fileCount):self._setProgress(pct)},!1),xhrobj},_ajaxSubmit:function(fnBefore,fnSuccess,fnComplete,fnError,previewId,index){var settings,self=this;self._raise("filepreajax",[previewId,index]),self._uploadExtra(previewId,index),settings=$.extend(!0,{},{xhr:function(){var xhrobj=$.ajaxSettings.xhr();return self._initXhr(xhrobj,previewId,self.getFileStack().length)},url:self.uploadUrl,type:"POST",dataType:"json",data:self.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:fnBefore,success:fnSuccess,complete:fnComplete,error:fnError},self.ajaxSettings),self.ajaxRequests.push($.ajax(settings))},_initUploadSuccess:function(out,$thumb,allFiles){var append,data,index,$div,$newCache,content,config,tags,i,self=this,mergeArray=function(prop,content){self[prop]instanceof Array||(self[prop]=[]),content&&content.length&&(self[prop]=self[prop].concat(content))};self.showPreview&&"object"==typeof out&&!$.isEmptyObject(out)&&void 0!==out.initialPreview&&out.initialPreview.length>0&&(self.hasInitData=!0,content=out.initialPreview||[],config=out.initialPreviewConfig||[],tags=out.initialPreviewThumbTags||[],append=!(void 0!==out.append&&!out.append),content.length>0&&!$h.isArray(content)&&(content=content.split(self.initialPreviewDelimiter)),self.overwriteInitial=!1,mergeArray("initialPreview",content),mergeArray("initialPreviewConfig",config),mergeArray("initialPreviewThumbTags",tags),void 0!==$thumb?allFiles?(i=$thumb.attr("data-fileindex"),self.uploadCache.content[i]=content[0],self.uploadCache.config[i]=config[0]||[],self.uploadCache.tags[i]=tags[0]||[],self.uploadCache.append=append):(index=self.previewCache.add(content,config[0],tags[0],append),data=self.previewCache.get(index,!1),$div=$(document.createElement("div")).html(data).hide().insertAfter($thumb),$newCache=$div.find(".kv-zoom-cache"),$newCache&&$newCache.length&&$newCache.insertAfter($thumb),$thumb.fadeOut("slow",function(){var $newThumb=$div.find(".file-preview-frame");$newThumb&&$newThumb.length&&$newThumb.insertBefore($thumb).fadeIn("slow").css("display:inline-block"),self._initPreviewActions(),self._clearFileInput(),$h.cleanZoomCache(self.$preview.find("#zoom-"+$thumb.attr("id"))),$thumb.remove(),$div.remove(),self._initSortable()})):(self.previewCache.set(content,config,tags,append),self._initPreview(),self._initPreviewActions()))},_initSuccessThumbs:function(){var self=this;self.showPreview&&self._getThumbs($h.FRAMES+" .file-preview-success").each(function(){var $thumb=$(this),$preview=self.$preview,$remove=$thumb.find(".kv-file-remove");$remove.removeAttr("disabled"),$h.handler($remove,"click",function(){var id=$thumb.attr("id"),out=self._raise("filesuccessremove",[id,$thumb.data("fileindex")]);$h.cleanMemory($thumb),out!==!1&&$thumb.fadeOut("slow",function(){$h.cleanZoomCache($preview.find("#zoom-"+id)),$thumb.remove(),$preview.find($h.FRAMES).length||self.reset()})})})},_checkAsyncComplete:function(){var previewId,i,self=this;for(i=0;i<self.filestack.length;i++)if(self.filestack[i]&&(previewId=self.previewInitId+"-"+i,$.inArray(previewId,self.uploadLog)===-1))return!1;return self.uploadAsyncCount===self.uploadLog.length},_uploadExtra:function(previewId,index){var self=this,data=self._getExtraData(previewId,index);0!==data.length&&$.each(data,function(key,value){self.formdata.append(key,value)})},_uploadSingle:function(i,files,allFiles){var outData,$thumb,chkComplete,$btnUpload,$btnDelete,fnBefore,fnSuccess,fnComplete,fnError,updateUploadLog,self=this,total=self.getFileStack().length,formdata=new FormData,previewId=self.previewInitId+"-"+i,hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData),$prog=$("#"+previewId).find(".file-thumb-progress"),params={id:previewId,index:i};self.formdata=formdata,self.showPreview&&($thumb=$("#"+previewId+":not(.file-preview-initial)"),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove"),$prog.removeClass("hide")),0===total||!hasPostData||$btnUpload&&$btnUpload.hasClass("disabled")||self._abort(params)||(updateUploadLog=function(i,previewId){self.updateStack(i,void 0),self.uploadLog.push(previewId),self._checkAsyncComplete()&&(self.fileBatchCompleted=!0)},chkComplete=function(){var $initThumbs,i,j,len,u=self.uploadCache,data=self.cacheInitialPreview;self.fileBatchCompleted&&setTimeout(function(){if(self.showPreview){if(self.previewCache.set(u.content,u.config,u.tags,u.append),len=data&&data.content?data.content.length:0){for(i=0;i<u.content.length;i++)j=i+len,data.content[j]=u.content[i],data.config.length&&(data.config[j]=u.config[i]),data.tags.length&&(data.tags[j]=u.tags[i]);self.initialPreview=data.content,self.initialPreviewConfig=data.config,self.initialPreviewThumbTags=data.tags}else self.initialPreview=u.content,self.initialPreviewConfig=u.config,self.initialPreviewThumbTags=u.tags;self.cacheInitialPreview={},self.hasInitData&&(self._initPreview(),self._initPreviewActions())}self.unlock(),self._clearFileInput(),$initThumbs=self.$preview.find(".file-preview-initial"),self.uploadAsync&&$initThumbs.length&&($h.addCss($initThumbs,$h.SORT_CSS),self._initSortable()),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()]),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self._setProgress(101)},100)},fnBefore=function(jqXHR){outData=self._getOutData(jqXHR),self.fileBatchCompleted=!1,self.showPreview&&($thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),$h.addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)),allFiles||self.lock(),self._raise("filepreupload",[outData,previewId,i]),$.extend(!0,params,outData),self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var pid=self.showPreview&&$thumb.attr("id")?$thumb.attr("id"):previewId;outData=self._getOutData(jqXHR,data),$.extend(!0,params,outData),setTimeout(function(){$h.isEmpty(data)||$h.isEmpty(data.error)?(self.showPreview&&(self._setThumbStatus($thumb,"Success"),$btnUpload.hide(),self._initUploadSuccess(data,$thumb,allFiles),self._setProgress(101,$prog)),self._raise("fileuploaded",[outData,pid,i]),allFiles?updateUploadLog(i,pid):self.updateStack(i,void 0)):(self._showUploadError(data.error,params),self._setPreviewError($thumb,i),allFiles&&updateUploadLog(i,pid))},100)},fnComplete=function(){setTimeout(function(){self.showPreview&&($btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),$thumb.removeClass("file-uploading")),allFiles?chkComplete():(self.unlock(!1),self._clearFileInput()),self._initSuccessThumbs()},100)},fnError=function(jqXHR,textStatus,errorThrown){var op=self.ajaxOperations.uploadThumb,errMsg=self._parseError(op,jqXHR,errorThrown,allFiles?files[i].name:null);setTimeout(function(){allFiles&&updateUploadLog(i,previewId),self.uploadStatus[previewId]=100,self._setPreviewError($thumb,i),$.extend(!0,params,self._getOutData(jqXHR)),self._setProgress(101,$prog,self.msgAjaxProgressError.replace("{operation}",op)),self._showUploadError(errMsg,params)},100)},formdata.append(self.uploadFileAttr,files[i],self.filenames[i]),formdata.append("file_id",i),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError,previewId,i))},_uploadBatch:function(){var fnBefore,fnSuccess,fnError,fnComplete,setAllUploaded,self=this,files=self.filestack,total=files.length,params={},hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData);self.formdata=new FormData,0!==total&&hasPostData&&!self._abort(params)&&(setAllUploaded=function(){$.each(files,function(key){self.updateStack(key,void 0)}),self._clearFileInput()},fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self.showPreview&&self._getThumbs().each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove");$thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),$h.addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)}),self._raise("filebatchpreupload",[outData]),self._abort(outData)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data),$thumbs=self._getThumbs(":not(.file-preview-error)"),key=0,keys=$h.isEmpty(data)||$h.isEmpty(data.errorkeys)?[]:data.errorkeys;$h.isEmpty(data)||$h.isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),setAllUploaded(),self.showPreview?($thumbs.each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload");$thumb.find(".kv-file-upload").hide(),self._setThumbStatus($thumb,"Success"),$thumb.removeClass("file-uploading"),$btnUpload.removeAttr("disabled")}),self._initUploadSuccess(data)):self.reset(),self._setProgress(101)):(self.showPreview&&($thumbs.each(function(){var $thumb=$(this),$btnDelete=$thumb.find(".kv-file-remove"),$btnUpload=$thumb.find(".kv-file-upload");if($thumb.removeClass("file-uploading"),$btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),0===keys.length)return void self._setPreviewError($thumb);$.inArray(key,keys)!==-1?self._setPreviewError($thumb):($thumb.find(".kv-file-upload").hide(),self._setThumbStatus($thumb,"Success"),self.updateStack(key,void 0)),key++}),self._initUploadSuccess(data)),self._showUploadError(data.error,outData,"filebatchuploaderror"))},fnComplete=function(){self.unlock(),self._initSuccessThumbs(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),op=self.ajaxOperations.uploadBatch,errMsg=self._parseError(op,jqXHR,errorThrown);self._showUploadError(errMsg,outData,"filebatchuploaderror"),self.uploadFileCount=total-1,self.showPreview&&(self._getThumbs().each(function(){var $thumb=$(this),key=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[key]&&self._setPreviewError($thumb)}),self._getThumbs().removeClass("file-uploading"),self._getThumbs(" .kv-file-upload").removeAttr("disabled"),self._getThumbs(" .kv-file-delete").removeAttr("disabled"),self._setProgress(101,self.$progress,self.msgAjaxProgressError.replace("{operation}",op)))},$.each(files,function(key,data){$h.isEmpty(files[key])||self.formdata.append(self.uploadFileAttr,data,self.filenames[key])}),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_uploadExtraOnly:function(){var fnBefore,fnSuccess,fnComplete,fnError,self=this,params={};self.formdata=new FormData,self._abort(params)||(fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self._raise("filebatchpreupload",[outData]),self._setProgress(50),params.data=outData,params.xhr=jqXHR,self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data);$h.isEmpty(data)||$h.isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),self._clearFileInput(),self._initUploadSuccess(data),self._setProgress(101)):self._showUploadError(data.error,outData,"filebatchuploaderror")},fnComplete=function(){self.unlock(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),op=self.ajaxOperations.uploadExtra,errMsg=self._parseError(op,jqXHR,errorThrown);params.data=outData,self._showUploadError(errMsg,outData,"filebatchuploaderror"),self._setProgress(101,self.$progress,self.msgAjaxProgressError.replace("{operation}",op))},self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_initFileActions:function(){var self=this,$preview=self.$preview;self.showPreview&&(self._initZoomButton(),$preview.find($h.FRAMES+" .kv-file-remove").each(function(){var hasError,n,cap,status,$el=$(this),$frame=$el.closest($h.FRAMES),id=$frame.attr("id"),ind=$frame.attr("data-fileindex");$h.handler($el,"click",function(){if((status=self._raise("filepreremove",[id,ind]))===!1||!self._validateMinCount())return!1;hasError=$frame.hasClass("file-preview-error"),$h.cleanMemory($frame),$frame.fadeOut("slow",function(){$h.cleanZoomCache($preview.find("#zoom-"+id)),self.updateStack(ind,void 0),self._clearObjects($frame),$frame.remove(),id&&hasError&&self.$errorContainer.find('li[data-file-id="'+id+'"]').fadeOut("fast",function(){$(this).remove(),self._errorsExist()||self._resetErrors()}),self._clearFileInput();var filestack=self.getFileStack(!0),chk=self.previewCache.count(),len=filestack.length,hasThumb=self.showPreview&&$preview.find($h.FRAMES).length;0!==len||0!==chk||hasThumb?(n=chk+len,cap=n>1?self._getMsgSelected(n):filestack[0]?self._getFileNames()[0]:"",self._setCaption(cap)):self.reset(),self._raise("fileremoved",[id,ind])})})}),self.$preview.find($h.FRAMES+" .kv-file-upload").each(function(){var $el=$(this);$h.handler($el,"click",function(){var $frame=$el.closest($h.FRAMES),ind=$frame.attr("data-fileindex");$frame.hasClass("file-preview-error")||self._uploadSingle(ind,self.filestack,!1)})}))},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(bytes){var i,sizes,out,self=this,size=parseFloat(bytes),func=self.fileSizeGetter;return $.isNumeric(bytes)&&$.isNumeric(size)?("function"==typeof func?out=func(size):(i=Math.floor(Math.log(size)/Math.log(1024)),sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],out=1*(size/Math.pow(1024,i)).toFixed(2)+" "+sizes[i]),self._getLayoutTemplate("size").replace("{sizeText}",out)):""},_generatePreviewTemplate:function(cat,data,fname,ftype,previewId,isError,size,frameClass,foot,ind,templ){
var self=this,caption=self.slug(fname),zoomContent="",config=self.previewSettings[cat]||self.defaults.previewSettings[cat],w=config&&config.width?config.width:"",h=config&&config.height?config.height:"",footer=foot||self._renderFileFooter(caption,size,$h.isEmpty(w)?"auto":w,isError),hasIconSetting=self._getPreviewIcon(fname),forcePrevIcon=hasIconSetting&&self.preferIconicPreview,forceZoomIcon=hasIconSetting&&self.preferIconicZoomPreview,getContent=function(c,d,zoom,frameCss){var id=zoom?"zoom-"+previewId:previewId,tmplt=self._getPreviewTemplate(c),css=(frameClass||"")+" "+frameCss;return self.frameClass&&(css=self.frameClass+" "+css),zoom&&(css=css.replace(" "+$h.SORT_CSS,"")),tmplt=self._parseFilePreviewIcon(tmplt,fname),"text"===c&&(d=$h.htmlEncode(d)),tmplt.replace(/\{previewId}/g,id).replace(/\{caption}/g,caption).replace(/\{frameClass}/g,css).replace(/\{type}/g,ftype).replace(/\{fileindex}/g,ind).replace(/\{width}/g,w).replace(/\{height}/g,h).replace(/\{footer}/g,footer).replace(/\{data}/g,d).replace(/\{template}/g,templ||cat)};return ind=ind||previewId.slice(previewId.lastIndexOf("-")+1),self.fileActionSettings.showZoom&&(zoomContent=getContent(forceZoomIcon?"other":cat,data,!0,"kv-zoom-thumb")),zoomContent="\n"+self._getLayoutTemplate("zoomCache").replace("{zoomContent}",zoomContent),getContent(forcePrevIcon?"other":cat,data,!1,"kv-preview-thumb")+zoomContent},_previewDefault:function(file,previewId,isDisabled){var self=this,$preview=self.$preview;if(self.showPreview){var content,fname=file?file.name:"",ftype=file?file.type:"",size=file.size,caption=self.slug(fname),isError=isDisabled===!0&&!self.isUploadable,data=$h.objUrl.createObjectURL(file);self._clearDefaultPreview(),content=self._generatePreviewTemplate("other",data,fname,ftype,previewId,isError,size),$preview.append("\n"+content),self._setThumbAttr(previewId,caption,size),isDisabled===!0&&self.isUploadable&&self._setThumbStatus($("#"+previewId),"Error")}},_previewFile:function(i,file,theFile,previewId,data){if(this.showPreview){var content,self=this,cat=self._parseFileType(file),fname=file?file.name:"",caption=self.slug(fname),types=self.allowedPreviewTypes,mimes=self.allowedPreviewMimeTypes,$preview=self.$preview,chkTypes=types&&types.indexOf(cat)>=0,size=file.size,iData="text"===cat||"html"===cat||"image"===cat?theFile.target.result:data,chkMimes=mimes&&mimes.indexOf(file.type)!==-1;"html"===cat&&self.purifyHtml&&window.DOMPurify&&(iData=window.DOMPurify.sanitize(iData)),chkTypes||chkMimes?(content=self._generatePreviewTemplate(cat,iData,fname,file.type,previewId,!1,size),self._clearDefaultPreview(),$preview.append("\n"+content),self._validateImage(previewId,caption,file.type)):self._previewDefault(file,previewId),self._setThumbAttr(previewId,caption,size),self._initSortable()}},_setThumbAttr:function(id,caption,size){var self=this,$frame=$("#"+id);$frame.length&&(size=size&&size>0?self._getSize(size):"",$frame.data({caption:caption,size:size}))},_setInitThumbAttr:function(){var config,caption,size,previewId,self=this,data=self.previewCache.data,len=self.previewCache.count(!0);if(0!==len)for(var i=0;i<len;i++)config=data.config[i],previewId=self.previewInitId+"-init_"+i,caption=$h.ifSet("caption",config,$h.ifSet("filename",config)),size=$h.ifSet("size",config),self._setThumbAttr(previewId,caption,size)},_slugDefault:function(text){return $h.isEmpty(text)?"":String(text).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(files){this.reader=new FileReader;var readFile,self=this,$el=self.$element,$preview=self.$preview,reader=self.reader,$container=self.$previewContainer,$status=self.$previewStatus,msgLoading=self.msgLoading,msgProgress=self.msgProgress,previewInitId=self.previewInitId,numFiles=files.length,settings=self.fileTypeSettings,ctr=self.filestack.length,fileTypes=self.allowedFileTypes,typLen=fileTypes?fileTypes.length:0,fileExt=self.allowedFileExtensions,strExt=$h.isEmpty(fileExt)?"":fileExt.join(", "),maxPreviewSize=self.maxFilePreviewSize&&parseFloat(self.maxFilePreviewSize),canPreview=$preview.length&&(!maxPreviewSize||isNaN(maxPreviewSize)),throwError=function(msg,file,previewId,index){var p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self._previewDefault(file,previewId,!0),self.isUploadable&&(self.addToStack(void 0),setTimeout(function(){readFile(index+1)},100)),self._initFileActions(),self.removeFromPreviewOnError&&$("#"+previewId).remove(),self.isUploadable?self._showUploadError(msg,p1):self._showError(msg,p2)};self.loadedImages=[],self.totalImagesCount=0,$.each(files,function(key,file){var func=self.fileTypeSettings.image;func&&func(file.type)&&self.totalImagesCount++}),readFile=function(i){if($h.isEmpty($el.attr("multiple"))&&(numFiles=1),i>=numFiles)return self.isUploadable&&self.filestack.length>0?self._raise("filebatchselected",[self.getFileStack()]):self._raise("filebatchselected",[files]),$container.removeClass("file-thumb-loading"),void $status.html("");var isText,isImage,fSizeKB,j,msg,typ,chk,typ1,typ2,node=ctr+i,previewId=previewInitId+"-"+node,file=files[i],caption=file.name?self.slug(file.name):"",fileSize=(file.size||0)/1e3,fileExtExpr="",previewData=$h.objUrl.createObjectURL(file),fileCount=0,strTypes="";if(typLen>0)for(j=0;j<typLen;j++)typ1=fileTypes[j],typ2=self.msgFileTypes[typ1]||typ1,strTypes+=0===j?typ2:", "+typ2;if(caption===!1)return void readFile(i+1);if(0===caption.length)return msg=self.msgInvalidFileName.replace("{name}",$h.htmlEncode(file.name)),void(self.isError=throwError(msg,file,previewId,i));if($h.isEmpty(fileExt)||(fileExtExpr=new RegExp("\\.("+fileExt.join("|")+")$","i")),fSizeKB=fileSize.toFixed(2),self.maxFileSize>0&&fileSize>self.maxFileSize)return msg=self.msgSizeTooLarge.replace("{name}",caption).replace("{size}",fSizeKB).replace("{maxSize}",self.maxFileSize),void(self.isError=throwError(msg,file,previewId,i));if(null!==self.minFileSize&&fileSize<=$h.getNum(self.minFileSize))return msg=self.msgSizeTooSmall.replace("{name}",caption).replace("{size}",fSizeKB).replace("{minSize}",self.minFileSize),void(self.isError=throwError(msg,file,previewId,i));if(!$h.isEmpty(fileTypes)&&$h.isArray(fileTypes)){for(j=0;j<fileTypes.length;j+=1)typ=fileTypes[j],fileCount+=settings[typ]?1:0;if(0===fileCount)return msg=self.msgInvalidFileType.replace("{name}",caption).replace("{types}",strTypes),void(self.isError=throwError(msg,file,previewId,i))}return 0!==fileCount||$h.isEmpty(fileExt)||!$h.isArray(fileExt)||$h.isEmpty(fileExtExpr)||(chk=$h.compare(caption,fileExtExpr),0!==(fileCount+=$h.isEmpty(chk)?0:chk.length))?self.showPreview?!canPreview&&fileSize>maxPreviewSize?(self.addToStack(file),$container.addClass("file-thumb-loading"),self._previewDefault(file,previewId),self._initFileActions(),self._updateFileDetails(numFiles),void readFile(i+1)):($preview.length&&void 0!==FileReader?($status.html(msgLoading.replace("{index}",i+1).replace("{files}",numFiles)),$container.addClass("file-thumb-loading"),reader.onerror=function(evt){self._errorHandler(evt,caption)},reader.onload=function(theFile){self._previewFile(i,file,theFile,previewId,previewData),self._initFileActions()},reader.onloadend=function(){msg=msgProgress.replace("{index}",i+1).replace("{files}",numFiles).replace("{percent}",50).replace("{name}",caption),setTimeout(function(){$status.html(msg),self._updateFileDetails(numFiles),readFile(i+1)},100),self._raise("fileloaded",[file,previewId,i,reader])},reader.onprogress=function(data){if(data.lengthComputable){var fact=data.loaded/data.total*100,progress=Math.ceil(fact);msg=msgProgress.replace("{index}",i+1).replace("{files}",numFiles).replace("{percent}",progress).replace("{name}",caption),setTimeout(function(){$status.html(msg)},100)}},isText=settings.text,isImage=settings.image,isText(file.type,caption)?reader.readAsText(file,self.textEncoding):isImage(file.type,caption)?reader.readAsDataURL(file):reader.readAsArrayBuffer(file)):(self._previewDefault(file,previewId),setTimeout(function(){readFile(i+1),self._updateFileDetails(numFiles)},100),self._raise("fileloaded",[file,previewId,i,reader])),void self.addToStack(file)):(self.addToStack(file),setTimeout(function(){readFile(i+1)},100),void self._raise("fileloaded",[file,previewId,i,reader])):(msg=self.msgInvalidFileExtension.replace("{name}",caption).replace("{extensions}",strExt),void(self.isError=throwError(msg,file,previewId,i)))},readFile(0),self._updateFileDetails(numFiles,!1)},_updateFileDetails:function(numFiles){var self=this,$el=self.$element,fileStack=self.getFileStack(),name=$h.isIE(9)&&$h.findFileName($el.val())||$el[0].files[0]&&$el[0].files[0].name||fileStack.length&&fileStack[0].name||"",label=self.slug(name),n=self.isUploadable?fileStack.length:numFiles,nFiles=self.previewCache.count()+n,log=n>1?self._getMsgSelected(nFiles):label;self.isError?(self.$previewContainer.removeClass("file-thumb-loading"),self.$previewStatus.html(""),self.$captionContainer.find(".kv-caption-icon").hide()):self._showFileIcon(),self._setCaption(log,self.isError),self.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&self._raise("fileselect",[numFiles,label]),self.previewCache.count()&&self._initPreviewActions()},_setThumbStatus:function($thumb,status){var self=this;if(self.showPreview){var icon="indicator"+status,msg=icon+"Title",css="file-preview-"+status.toLowerCase(),$indicator=$thumb.find(".file-upload-indicator"),config=self.fileActionSettings;$thumb.removeClass("file-preview-success file-preview-error file-preview-loading"),"Error"===status&&$thumb.find(".kv-file-upload").attr("disabled",!0),"Success"===status&&($thumb.find(".file-drag-handle").remove(),$indicator.css("margin-left",0)),$indicator.html(config[icon]),$indicator.attr("title",config[msg]),$thumb.addClass(css)}},_setProgressCancelled:function(){var self=this;self._setProgress(101,self.$progress,self.msgCancelled)},_setProgress:function(p,$el,error){var self=this,pct=Math.min(p,100),template=pct<100?self.progressTemplate:error?self.progressErrorTemplate:p<=100?self.progressTemplate:self.progressCompleteTemplate,pctLimit=self.progressUploadThreshold;if($el=$el||self.$progress,!$h.isEmpty(template)){if(pctLimit&&pct>pctLimit&&p<=100){var out=template.replace("{percent}",pctLimit).replace("{percent}",pctLimit).replace("{percent}%",self.msgUploadThreshold);$el.html(out)}else $el.html(template.replace(/\{percent}/g,pct));error&&$el.find('[role="progressbar"]').html(error)}},_setFileDropZoneTitle:function(){var strFiles,self=this,$zone=self.$container.find(".file-drop-zone"),title=self.dropZoneTitle;self.isClickable&&(strFiles=$h.isEmpty(self.$element.attr("multiple"))?self.fileSingle:self.filePlural,title+=self.dropZoneClickTitle.replace("{files}",strFiles)),$zone.find("."+self.dropZoneTitleClass).remove(),self.isUploadable&&self.showPreview&&0!==$zone.length&&!(self.getFileStack().length>0)&&self.dropZoneEnabled&&(0===$zone.find($h.FRAMES).length&&$h.isEmpty(self.defaultPreviewContent)&&$zone.prepend('<div class="'+self.dropZoneTitleClass+'">'+title+"</div>"),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(previewId,pct,total){var self=this,sum=0;self._setProgress(pct,$("#"+previewId).find(".file-thumb-progress")),self.uploadStatus[previewId]=pct,$.each(self.uploadStatus,function(key,value){sum+=value}),self._setProgress(Math.floor(sum/total))},_validateMinCount:function(){var self=this,len=self.isUploadable?self.getFileStack().length:self.$element.get(0).files.length;return!(self.validateInitialCount&&self.minFileCount>0&&self._getFileCount(len-1)<self.minFileCount)||(self._noFilesError({}),!1)},_getFileCount:function(fileCount){var self=this,addCount=0;return self.validateInitialCount&&!self.overwriteInitial&&(addCount=self.previewCache.count(),fileCount+=addCount),fileCount},_getFileName:function(file){return file&&file.name?this.slug(file.name):void 0},_getFileNames:function(skipNull){return this.filenames.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},_setPreviewError:function($thumb,i,val){var self=this;void 0!==i&&self.updateStack(i,val),self.removeFromPreviewOnError?$thumb.remove():self._setThumbStatus($thumb,"Error")},_checkDimensions:function(i,chk,$img,$thumb,fname,type,params){var msg,dim,$imgEl,self=this,tag="Small"===chk?"min":"max",limit=self[tag+"Image"+type];!$h.isEmpty(limit)&&$img.length&&($imgEl=$img[0],dim="Width"===type?$imgEl.naturalWidth||$imgEl.width:$imgEl.naturalHeight||$imgEl.height,("Small"===chk?dim>=limit:dim<=limit)||(msg=self["msgImage"+type+chk].replace("{name}",fname).replace("{size}",limit),self._showUploadError(msg,params),self._setPreviewError($thumb,i,null)))},_validateImage:function(previewId,fname,ftype){var params,w1,w2,self=this,$preview=self.$preview,$thumb=$preview.find("#"+previewId),i=$thumb.attr("data-fileindex"),$img=$thumb.find("img");fname=fname||"Untitled",$img.length&&$h.handler($img,"load",function(){w1=$thumb.width(),w2=$preview.width(),w1>w2&&($img.css("width","100%"),$thumb.css("width","97%")),params={ind:i,id:previewId},self._checkDimensions(i,"Small",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Small",$img,$thumb,fname,"Height",params),self.resizeImage||(self._checkDimensions(i,"Large",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Large",$img,$thumb,fname,"Height",params)),self._raise("fileimageloaded",[previewId]),self.loadedImages.push({ind:i,img:$img,thumb:$thumb,pid:previewId,typ:ftype}),self._validateAllImages()})},_validateAllImages:function(){var i,self=this,counter={val:0},numImgs=self.loadedImages.length;if(numImgs===self.totalImagesCount&&(self._raise("fileimagesloaded"),self.resizeImage))for(i=0;i<self.loadedImages.length;i++)self._getResizedImage(self.loadedImages[i],counter,numImgs)},_getResizedImage:function(config,counter,numImgs){var chkWidth,chkHeight,errFunc,throwError,msg,self=this,img=config.img,width=img.naturalWidth,height=img.naturalHeight,ratio=1,maxWidth=self.maxImageWidth||width,maxHeight=self.maxImageHeight||height,isValidImage=!(!width||!height),canvas=self.imageCanvas,context=self.imageCanvasContext,type=config.typ,pid=config.pid,ind=config.ind,thumb=config.thumb;if(errFunc=self.isUploadable?self._showUploadError:self._showError,throwError=function(msg,params,ev){errFunc(msg,params,ev),self._setPreviewError(thumb,ind)},(!self.filestack[ind]||!isValidImage||width<=maxWidth&&height<=maxHeight)&&(isValidImage&&self.filestack[ind]&&self._raise("fileimageresized",[pid,ind]),counter.val++,counter.val===numImgs&&self._raise("fileimagesresized"),!isValidImage))return void throwError(self.msgImageResizeError,{id:pid,index:ind},"fileimageresizeerror");type=type||self.resizeDefaultImageType,chkWidth=width>maxWidth,chkHeight=height>maxHeight,ratio="width"===self.resizePreference?chkWidth?maxWidth/width:chkHeight?maxHeight/height:1:chkHeight?maxHeight/height:chkWidth?maxWidth/width:1,self._resetCanvas(),width*=ratio,height*=ratio,canvas.width=width,canvas.height=height;try{context.drawImage(img,0,0,width,height),canvas.toBlob(function(blob){self.filestack[ind]=blob,self._raise("fileimageresized",[pid,ind]),counter.val++,counter.val===numImgs&&self._raise("fileimagesresized",[void 0,void 0]),blob instanceof Blob||throwError(self.msgImageResizeError,{id:pid,index:ind},"fileimageresizeerror")},type,self.resizeQuality)}catch(err){counter.val++,counter.val===numImgs&&self._raise("fileimagesresized",[void 0,void 0]),msg=self.msgImageResizeException.replace("{errors}",err.message),throwError(msg,{id:pid,index:ind},"fileimageresizeexception")}},_initBrowse:function($container){var self=this;self.showBrowse?(self.$btnFile=$container.find(".btn-file"),self.$btnFile.append(self.$element)):self.$element.hide()},_initCaption:function(){var self=this,cap=self.initialCaption||"";return self.overwriteInitial||$h.isEmpty(cap)?(self.$caption.html(""),!1):(self._setCaption(cap),!0)},_setCaption:function(content,isError){var title,out,n,cap,self=this,stack=self.getFileStack();if(self.$caption.length){if(isError)title=$("<div>"+self.msgValidationError+"</div>").text(),n=stack.length,cap=n?1===n&&stack[0]?self._getFileNames()[0]:self._getMsgSelected(n):self._getMsgSelected(self.msgNo),out='<span class="'+self.msgValidationErrorClass+'">'+self.msgValidationErrorIcon+($h.isEmpty(content)?cap:content)+"</span>";else{if($h.isEmpty(content))return;title=$("<div>"+content+"</div>").text(),out=self._getLayoutTemplate("fileIcon")+title}self.$caption.html(out),self.$caption.attr("title",title),self.$captionContainer.find(".file-caption-ellipsis").attr("title",title)}},_createContainer:function(){var self=this,$container=$(document.createElement("div")).attr({class:"file-input file-input-new"}).html(self._renderMain());return self.$element.before($container),self._initBrowse($container),self.theme&&$container.addClass("theme-"+self.theme),$container},_refreshContainer:function(){var self=this,$container=self.$container;$container.before(self.$element),$container.html(self._renderMain()),self._initBrowse($container)},_renderMain:function(){var self=this,dropCss=self.isUploadable&&self.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",close=self.showClose?self._getLayoutTemplate("close"):"",preview=self.showPreview?self._getLayoutTemplate("preview").replace(/\{class}/g,self.previewClass).replace(/\{dropClass}/g,dropCss):"",css=self.isDisabled?self.captionClass+" file-caption-disabled":self.captionClass,caption=self.captionTemplate.replace(/\{class}/g,css+" kv-fileinput-caption");return self.mainTemplate.replace(/\{class}/g,self.mainClass+(!self.showBrowse&&self.showCaption?" no-browse":"")).replace(/\{preview}/g,preview).replace(/\{close}/g,close).replace(/\{caption}/g,caption).replace(/\{upload}/g,self._renderButton("upload")).replace(/\{remove}/g,self._renderButton("remove")).replace(/\{cancel}/g,self._renderButton("cancel")).replace(/\{browse}/g,self._renderButton("browse"))},_renderButton:function(type){var self=this,tmplt=self._getLayoutTemplate("btnDefault"),css=self[type+"Class"],title=self[type+"Title"],icon=self[type+"Icon"],label=self[type+"Label"],status=self.isDisabled?" disabled":"",btnType="button";switch(type){case"remove":if(!self.showRemove)return"";break;case"cancel":if(!self.showCancel)return"";css+=" hide";break;case"upload":if(!self.showUpload)return"";self.isUploadable&&!self.isDisabled?tmplt=self._getLayoutTemplate("btnLink").replace("{href}",self.uploadUrl):btnType="submit";break;case"browse":if(!self.showBrowse)return"";tmplt=self._getLayoutTemplate("btnBrowse");break;default:return""}return css+="browse"===type?" btn-file":" fileinput-"+type+" fileinput-"+type+"-button",$h.isEmpty(label)||(label=' <span class="'+self.buttonLabelClass+'">'+label+"</span>"),tmplt.replace("{type}",btnType).replace("{css}",css).replace("{title}",title).replace("{status}",status).replace("{icon}",icon).replace("{label}",label)},_renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0")+"</div>"},_renderFileFooter:function(caption,size,width,isError){var out,self=this,config=self.fileActionSettings,rem=config.showRemove,drg=config.showDrag,upl=config.showUpload,zoom=config.showZoom,template=self._getLayoutTemplate("footer"),indicator=isError?config.indicatorError:config.indicatorNew,title=isError?config.indicatorErrorTitle:config.indicatorNewTitle;return size=self._getSize(size),out=self.isUploadable?template.replace(/\{actions}/g,self._renderFileActions(upl,rem,zoom,drg,!1,!1,!1)).replace(/\{caption}/g,caption).replace(/\{size}/g,size).replace(/\{width}/g,width).replace(/\{progress}/g,self._renderThumbProgress()).replace(/\{indicator}/g,indicator).replace(/\{indicatorTitle}/g,title):template.replace(/\{actions}/g,self._renderFileActions(!1,!1,zoom,drg,!1,!1,!1)).replace(/\{caption}/g,caption).replace(/\{size}/g,size).replace(/\{width}/g,width).replace(/\{progress}/g,"").replace(/\{indicator}/g,indicator).replace(/\{indicatorTitle}/g,title),out=$h.replaceTags(out,self.previewThumbTags)},_renderFileActions:function(showUpload,showDelete,showZoom,showDrag,disabled,url,key,isInit){if(!(showUpload||showDelete||showZoom||showDrag))return"";var css,self=this,vUrl=url===!1?"":' data-url="'+url+'"',vKey=key===!1?"":' data-key="'+key+'"',btnDelete="",btnUpload="",btnZoom="",btnDrag="",template=self._getLayoutTemplate("actions"),config=self.fileActionSettings,otherButtons=self.otherActionButtons.replace(/\{dataKey}/g,vKey),removeClass=disabled?config.removeClass+" disabled":config.removeClass;return showDelete&&(btnDelete=self._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,removeClass).replace(/\{removeIcon}/g,config.removeIcon).replace(/\{removeTitle}/g,config.removeTitle).replace(/\{dataUrl}/g,vUrl).replace(/\{dataKey}/g,vKey)),showUpload&&(btnUpload=self._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,config.uploadClass).replace(/\{uploadIcon}/g,config.uploadIcon).replace(/\{uploadTitle}/g,config.uploadTitle)),showZoom&&(btnZoom=self._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,config.zoomClass).replace(/\{zoomIcon}/g,config.zoomIcon).replace(/\{zoomTitle}/g,config.zoomTitle)),showDrag&&isInit&&(css="drag-handle-init "+config.dragClass,btnDrag=self._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,css).replace(/\{dragTitle}/g,config.dragTitle).replace(/\{dragIcon}/g,config.dragIcon)),template.replace(/\{delete}/g,btnDelete).replace(/\{upload}/g,btnUpload).replace(/\{zoom}/g,btnZoom).replace(/\{drag}/g,btnDrag).replace(/\{other}/g,otherButtons)},_browse:function(e){var self=this;self._raise("filebrowse"),e&&e.isDefaultPrevented()||(self.isError&&!self.isUploadable&&self.clear(),self.$captionContainer.focus())},_change:function(e){var self=this,$el=self.$element;if(!self.isUploadable&&$h.isEmpty($el.val())&&self.fileInputCleared)return void(self.fileInputCleared=!1);self.fileInputCleared=!1;var tfiles,msg,total,f,n,len,isDragDrop=arguments.length>1,isAjaxUpload=self.isUploadable,i=0,files=isDragDrop?e.originalEvent.dataTransfer.files:$el.get(0).files,ctr=self.filestack.length,isSingleUpload=$h.isEmpty($el.attr("multiple")),flagSingle=isSingleUpload&&ctr>0,folders=0,throwError=function(mesg,file,previewId,index){var p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self.isUploadable?self._showUploadError(mesg,p1):self._showError(mesg,p2)};if(self.reader=null,self._resetUpload(),self._hideFileIcon(),self.isUploadable&&self.$container.find(".file-drop-zone ."+self.dropZoneTitleClass).remove(),isDragDrop)for(tfiles=[];files[i];)f=files[i],f.type||f.size%4096!=0?tfiles.push(f):folders++,i++;else tfiles=void 0===e.target.files?e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files;if($h.isEmpty(tfiles)||0===tfiles.length)return isAjaxUpload||self.clear(),self._showFolderError(folders),void self._raise("fileselectnone");if(self._resetErrors(),len=tfiles.length,total=self._getFileCount(self.isUploadable?self.getFileStack().length+len:len),self.maxFileCount>0&&total>self.maxFileCount){if(!self.autoReplace||len>self.maxFileCount)return n=self.autoReplace&&len>self.maxFileCount?len:total,msg=self.msgFilesTooMany.replace("{m}",self.maxFileCount).replace("{n}",n),self.isError=throwError(msg,null,null,null),self.$captionContainer.find(".kv-caption-icon").hide(),self._setCaption("",!0),void self.$container.removeClass("file-input-new file-input-ajax-new");total>self.maxFileCount&&self._resetPreviewThumbs(isAjaxUpload)}else!isAjaxUpload||flagSingle?(self._resetPreviewThumbs(!1),flagSingle&&self.clearStack()):!isAjaxUpload||0!==ctr||self.previewCache.count()&&!self.overwriteInitial||self._resetPreviewThumbs(!0);self.isPreviewable?self._readFiles(tfiles):self._updateFileDetails(1),self._showFolderError(folders)},_abort:function(params){var data,self=this;return!(!self.ajaxAborted||"object"!=typeof self.ajaxAborted||void 0===self.ajaxAborted.message)&&(data=$.extend(!0,{},self._getOutData(),params),data.abortData=self.ajaxAborted.data||{},data.abortMessage=self.ajaxAborted.message,self.cancel(),self._setProgress(101,self.$progress,self.msgCancelled),self._showUploadError(self.ajaxAborted.message,data,"filecustomerror"),!0)},_resetFileStack:function(){var self=this,i=0,newstack=[],newnames=[];self._getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex"),file=self.filestack[ind];ind!==-1&&(void 0!==file?(newstack[i]=file,newnames[i]=self._getFileName(file),$thumb.attr({id:self.previewInitId+"-"+i,"data-fileindex":i}),i++):$thumb.attr({id:"uploaded-"+$h.uniqId(),"data-fileindex":"-1"}))}),self.filestack=newstack,self.filenames=newnames},clearStack:function(){var self=this;return self.filestack=[],self.filenames=[],self.$element},updateStack:function(i,file){var self=this;return self.filestack[i]=file,self.filenames[i]=self._getFileName(file),self.$element},addToStack:function(file){var self=this;return self.filestack.push(file),self.filenames.push(self._getFileName(file)),self.$element},getFileStack:function(skipNull){return this.filestack.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},getFilesCount:function(){var self=this,len=self.isUploadable?self.getFileStack().length:self.$element.get(0).files.length;return self._getFileCount(len)},lock:function(){var self=this;return self._resetErrors(),self.disable(),self.showRemove&&$h.addCss(self.$container.find(".fileinput-remove"),"hide"),self.showCancel&&self.$container.find(".fileinput-cancel").removeClass("hide"),self._raise("filelock",[self.filestack,self._getExtraData()]),self.$element},unlock:function(reset){var self=this;return void 0===reset&&(reset=!0),self.enable(),self.showCancel&&$h.addCss(self.$container.find(".fileinput-cancel"),"hide"),self.showRemove&&self.$container.find(".fileinput-remove").removeClass("hide"),reset&&self._resetFileStack(),self._raise("fileunlock",[self.filestack,self._getExtraData()]),self.$element},cancel:function(){var i,self=this,xhr=self.ajaxRequests,len=xhr.length;if(len>0)for(i=0;i<len;i+=1)self.cancelling=!0,xhr[i].abort();return self._setProgressCancelled(),self._getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[ind]&&($thumb.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),$thumb.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),self.unlock()}),self.$element},clear:function(){var cap,self=this;return self.$btnUpload.removeAttr("disabled"),self._getThumbs().find("video,audio,img").each(function(){$h.cleanMemory($(this))}),self._resetUpload(),self.clearStack(),self._clearFileInput(),self._resetErrors(!0),self._raise("fileclear"),self._hasInitialPreview()?(self._showFileIcon(),self._resetPreview(),self._initPreviewActions(),self.$container.removeClass("file-input-new")):(self._getThumbs().each(function(){self._clearObjects($(this))}),self.isUploadable&&(self.previewCache.data={}),self.$preview.html(""),cap=!self.overwriteInitial&&self.initialCaption.length>0?self.initialCaption:"",self.$caption.html(cap),self.$caption.attr("title",""),$h.addCss(self.$container,"file-input-new"),self._validateDefaultPreview()),0===self.$container.find($h.FRAMES).length&&(self._initCaption()||self.$captionContainer.find(".kv-caption-icon").hide()),self._hideFileIcon(),self._raise("filecleared"),self.$captionContainer.focus(),self._setFileDropZoneTitle(),self.$element},reset:function(){var self=this;return self._resetPreview(),self.$container.find(".fileinput-filename").text(""),self._raise("filereset"),$h.addCss(self.$container,"file-input-new"),(self.$preview.find($h.FRAMES).length||self.isUploadable&&self.dropZoneEnabled)&&self.$container.removeClass("file-input-new"),self._setFileDropZoneTitle(),self.clearStack(),self.formdata={},self.$element},disable:function(){var self=this;return self.isDisabled=!0,self._raise("filedisabled"),self.$element.attr("disabled","disabled"),self.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),self._initDragDrop(),self.$element},enable:function(){var self=this;return self.isDisabled=!1,self._raise("fileenabled"),self.$element.removeAttr("disabled"),self.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),self._initDragDrop(),self.$element},upload:function(){var i,outData,len,self=this,totLen=self.getFileStack().length,params={},hasExtraData=!$.isEmptyObject(self._getExtraData());if(self.isUploadable&&!self.isDisabled){if(self.minFileCount>0&&self._getFileCount(totLen)<self.minFileCount)return void self._noFilesError(params);if(0===totLen&&!hasExtraData)return self._resetUpload(),void self._showUploadError(self.msgUploadEmpty);if(self._resetUpload(),self.$progress.removeClass("hide"),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.lock(),self._setProgress(2),0===totLen&&hasExtraData)return void self._uploadExtraOnly();if(len=self.filestack.length,self.hasInitData=!1,!self.uploadAsync)return self._uploadBatch(),self.$element;for(outData=self._getOutData(),self._raise("filebatchpreupload",[outData]),self.fileBatchCompleted=!1,self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadAsyncCount=self.getFileStack().length,i=0;i<len;i++)self.uploadCache.content[i]=null,self.uploadCache.config[i]=null,self.uploadCache.tags[i]=null;for(self.$preview.find(".file-preview-initial").removeClass($h.SORT_CSS),self._initSortable(),self.cacheInitialPreview={content:self.initialPreview,config:self.initialPreviewConfig,tags:self.initialPreviewThumbTags},i=0;i<len;i++)void 0!==self.filestack[i]&&self._uploadSingle(i,self.filestack,!0)}},destroy:function(){var self=this,$cont=self.$container;return $cont.find(".file-drop-zone").off(),self.$element.insertBefore($cont).off($h.NAMESPACE).removeData(),$cont.off().remove(),self.$element},refresh:function(options){var self=this,$el=self.$element;return options=options?$.extend(!0,{},self.options,options):self.options,self.destroy(),$el.fileinput(options),$el.val()&&$el.trigger("change.fileinput"),$el}},$.fn.fileinput=function(option){if($h.hasFileAPISupport()||$h.isIE(9)){var args=Array.apply(null,arguments),retvals=[];switch(args.shift(),this.each(function(){var opt,self=$(this),data=self.data("fileinput"),options="object"==typeof option&&option,theme=options.theme||self.data("theme"),l={},t={},lang=options.language||self.data("language")||$.fn.fileinput.defaults.language||"en";data||(theme&&(t=$.fn.fileinputThemes[theme]||{}),"en"===lang||$h.isEmpty($.fn.fileinputLocales[lang])||(l=$.fn.fileinputLocales[lang]||{}),opt=$.extend(!0,{},$.fn.fileinput.defaults,t,$.fn.fileinputLocales.en,l,options,self.data()),data=new FileInput(this,opt),self.data("fileinput",data)),"string"==typeof option&&retvals.push(data[option].apply(data,args))}),retvals.length){case 0:return this;case 1:return retvals[0];default:return retvals}}},$.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},
overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},$.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"single file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},$.fn.fileinput.Constructor=FileInput,$(document).ready(function(){var $input=$("input.file[type=file]");$input.length&&$input.fileinput()})}),function($){"use strict";$.fn.fileinputLocales.fr={fileSingle:"fichier",filePlural:"fichiers",browseLabel:"Parcourir&hellip;",removeLabel:"Retirer",removeTitle:"Retirer les fichiers sélectionnés",cancelLabel:"Annuler",cancelTitle:"Annuler l'envoi en cours",uploadLabel:"Transférer",uploadTitle:"Transférer les fichiers sélectionnés",msgNo:"Non",msgNoFilesSelected:"",msgCancelled:"Annulé",msgZoomModalHeading:"Aperçu détaillé",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'Le fichier "{name}" (<b>{size} Ko</b>) dépasse la taille maximale autorisée qui est de <b>{maxSize} Ko</b>.',msgFilesTooLess:"Vous devez sélectionner au moins <b>{n}</b> {files} à transmettre.",msgFilesTooMany:"Le nombre de fichier sélectionné <b>({n})</b> dépasse la quantité maximale autorisée qui est de <b>{m}</b>.",msgFileNotFound:'Le fichier "{name}" est introuvable !',msgFileSecured:'Des restrictions de sécurité vous empêchent d\'accéder au fichier "{name}".',msgFileNotReadable:'Le fichier "{name}" est illisble.',msgFilePreviewAborted:'Prévisualisation du fichier "{name}" annulée.',msgFilePreviewError:'Une erreur est survenue lors de la lecture du fichier "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Type de document invalide pour "{name}". Seulement les documents de type "{types}" sont autorisés.',msgInvalidFileExtension:'Extension invalide pour le fichier "{name}". Seules les extensions "{extensions}" sont autorisées.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"Le téléchargement du fichier a été interrompu",msgUploadThreshold:"Processing...",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Erreur de validation",msgLoading:"Transmission du fichier {index} sur {files}&hellip;",msgProgress:"Transmission du fichier {index} sur {files} - {name} - {percent}% faits.",msgSelected:"{n} {files} sélectionné(s)",msgFoldersNotAllowed:"Glissez et déposez uniquement des fichiers ! {n} répertoire(s) exclu(s).",msgImageWidthSmall:'Largeur de fichier image "{name}" doit être d\'au moins {size} px.',msgImageHeightSmall:'Hauteur de fichier image "{name}" doit être d\'au moins {size} px.',msgImageWidthLarge:'Largeur de fichier image "{name}" ne peut pas dépasser {size} px.',msgImageHeightLarge:'Hauteur de fichier image "{name}" ne peut pas dépasser {size} px.',msgImageResizeError:"Impossible d'obtenir les dimensions de l'image à redimensionner.",msgImageResizeException:"Erreur lors du redimensionnement de l'image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"single file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Glissez et déposez les fichiers ici&hellip;",dropZoneClickTitle:"<br>(or click to select {files})",fileActionSettings:{removeTitle:"Supprimer le fichier",uploadTitle:"Télécharger un fichier",zoomTitle:"Voir les détails",dragTitle:"Move / Rearrange",indicatorNewTitle:"Pas encore téléchargé",indicatorSuccessTitle:"Posté",indicatorErrorTitle:"Ajouter erreur",indicatorLoadingTitle:"ajout ..."},previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}}}(window.jQuery),function($){$.Jcrop=function(obj,opt){function px(n){return Math.round(n)+"px"}function cssClass(cl){return options.baseClass+"-"+cl}function supportsColorFade(){return $.fx.step.hasOwnProperty("backgroundColor")}function getPos(obj){var pos=$(obj).offset();return[pos.left,pos.top]}function mouseAbs(e){return[e.pageX-docOffset[0],e.pageY-docOffset[1]]}function setOptions(opt){"object"!=typeof opt&&(opt={}),options=$.extend(options,opt),$.each(["onChange","onSelect","onRelease","onDblClick"],function(i,e){"function"!=typeof options[e]&&(options[e]=function(){})})}function startDragMode(mode,pos,touch){if(docOffset=getPos($img),Tracker.setCursor("move"===mode?mode:mode+"-resize"),"move"===mode)return Tracker.activateHandlers(createMover(pos),doneSelect,touch);var fc=Coords.getFixed(),opp=oppLockCorner(mode),opc=Coords.getCorner(oppLockCorner(opp));Coords.setPressed(Coords.getCorner(opp)),Coords.setCurrent(opc),Tracker.activateHandlers(dragmodeHandler(mode,fc),doneSelect,touch)}function dragmodeHandler(mode,f){return function(pos){if(options.aspectRatio)switch(mode){case"e":pos[1]=f.y+1;break;case"w":pos[1]=f.y+1;break;case"n":pos[0]=f.x+1;break;case"s":pos[0]=f.x+1}else switch(mode){case"e":pos[1]=f.y2;break;case"w":pos[1]=f.y2;break;case"n":pos[0]=f.x2;break;case"s":pos[0]=f.x2}Coords.setCurrent(pos),Selection.update()}}function createMover(pos){var lloc=pos;return KeyManager.watchKeys(),function(pos){Coords.moveOffset([pos[0]-lloc[0],pos[1]-lloc[1]]),lloc=pos,Selection.update()}}function oppLockCorner(ord){switch(ord){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function createDragger(ord){return function(e){return!options.disabled&&(!("move"===ord&&!options.allowMove)&&(docOffset=getPos($img),btndown=!0,startDragMode(ord,mouseAbs(e)),e.stopPropagation(),e.preventDefault(),!1))}}function presize($obj,w,h){var nw=$obj.width(),nh=$obj.height();nw>w&&w>0&&(nw=w,nh=w/$obj.width()*$obj.height()),nh>h&&h>0&&(nh=h,nw=h/$obj.height()*$obj.width()),xscale=$obj.width()/nw,yscale=$obj.height()/nh,$obj.width(nw).height(nh)}function unscale(c){return{x:c.x*xscale,y:c.y*yscale,x2:c.x2*xscale,y2:c.y2*yscale,w:c.w*xscale,h:c.h*yscale}}function doneSelect(pos){var c=Coords.getFixed();c.w>options.minSelect[0]&&c.h>options.minSelect[1]?(Selection.enableHandles(),Selection.done()):Selection.release(),Tracker.setCursor(options.allowSelect?"crosshair":"default")}function newSelection(e){if(!options.disabled&&options.allowSelect){btndown=!0,docOffset=getPos($img),Selection.disableHandles(),Tracker.setCursor("crosshair");var pos=mouseAbs(e);return Coords.setPressed(pos),Selection.update(),Tracker.activateHandlers(selectDrag,doneSelect,"touch"===e.type.substring(0,5)),KeyManager.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function selectDrag(pos){Coords.setCurrent(pos),Selection.update()}function newTracker(){var trk=$("<div></div>").addClass(cssClass("tracker"));return is_msie&&trk.css({opacity:0,backgroundColor:"white"}),trk}function setClass(cname){$div.removeClass().addClass(cssClass("holder")).addClass(cname)}function animateTo(a,callback){function queueAnimator(){window.setTimeout(animator,interv)}var x1=a[0]/xscale,y1=a[1]/yscale,x2=a[2]/xscale,y2=a[3]/yscale;if(!animating){var animto=Coords.flipCoords(x1,y1,x2,y2),c=Coords.getFixed(),initcr=[c.x,c.y,c.x2,c.y2],animat=initcr,interv=options.animationDelay,ix1=animto[0]-initcr[0],iy1=animto[1]-initcr[1],ix2=animto[2]-initcr[2],iy2=animto[3]-initcr[3],pcent=0,velocity=options.swingSpeed;x1=animat[0],y1=animat[1],x2=animat[2],y2=animat[3],Selection.animMode(!0);var animator=function(){return function(){pcent+=(100-pcent)/velocity,animat[0]=Math.round(x1+pcent/100*ix1),animat[1]=Math.round(y1+pcent/100*iy1),animat[2]=Math.round(x2+pcent/100*ix2),animat[3]=Math.round(y2+pcent/100*iy2),pcent>=99.8&&(pcent=100),pcent<100?(setSelectRaw(animat),queueAnimator()):(Selection.done(),Selection.animMode(!1),"function"==typeof callback&&callback.call(api))}}();queueAnimator()}}function setSelect(rect){setSelectRaw([rect[0]/xscale,rect[1]/yscale,rect[2]/xscale,rect[3]/yscale]),options.onSelect.call(api,unscale(Coords.getFixed())),Selection.enableHandles()}function setSelectRaw(l){Coords.setPressed([l[0],l[1]]),Coords.setCurrent([l[2],l[3]]),Selection.update()}function tellSelect(){return unscale(Coords.getFixed())}function tellScaled(){return Coords.getFixed()}function setOptionsNew(opt){setOptions(opt),interfaceUpdate()}function disableCrop(){options.disabled=!0,Selection.disableHandles(),Selection.setCursor("default"),Tracker.setCursor("default")}function enableCrop(){options.disabled=!1,interfaceUpdate()}function cancelCrop(){Selection.done(),Tracker.activateHandlers(null,null)}function destroy(){$div.remove(),$origimg.show(),$origimg.css("visibility","visible"),$(obj).removeData("Jcrop")}function setImage(src,callback){Selection.release(),disableCrop();var img=new Image;img.onload=function(){var iw=img.width,ih=img.height,bw=options.boxWidth,bh=options.boxHeight;$img.width(iw).height(ih),$img.attr("src",src),$img2.attr("src",src),presize($img,bw,bh),boundx=$img.width(),boundy=$img.height(),$img2.width(boundx).height(boundy),$trk.width(boundx+2*bound).height(boundy+2*bound),$div.width(boundx).height(boundy),Shade.resize(boundx,boundy),enableCrop(),"function"==typeof callback&&callback.call(api)},img.src=src}function colorChangeMacro($obj,color,now){var mycolor=color||options.bgColor;options.bgFade&&supportsColorFade()&&options.fadeTime&&!now?$obj.animate({backgroundColor:mycolor},{queue:!1,duration:options.fadeTime}):$obj.css("backgroundColor",mycolor)}function interfaceUpdate(alt){options.allowResize?alt?Selection.enableOnly():Selection.enableHandles():Selection.disableHandles(),Tracker.setCursor(options.allowSelect?"crosshair":"default"),Selection.setCursor(options.allowMove?"move":"default"),options.hasOwnProperty("trueSize")&&(xscale=options.trueSize[0]/boundx,yscale=options.trueSize[1]/boundy),options.hasOwnProperty("setSelect")&&(setSelect(options.setSelect),Selection.done(),delete options.setSelect),Shade.refresh(),options.bgColor!=bgcolor&&(colorChangeMacro(options.shade?Shade.getShades():$div,options.shade?options.shadeColor||options.bgColor:options.bgColor),bgcolor=options.bgColor),bgopacity!=options.bgOpacity&&(bgopacity=options.bgOpacity,options.shade?Shade.refresh():Selection.setBgOpacity(bgopacity)),xlimit=options.maxSize[0]||0,ylimit=options.maxSize[1]||0,xmin=options.minSize[0]||0,ymin=options.minSize[1]||0,options.hasOwnProperty("outerImage")&&($img.attr("src",options.outerImage),delete options.outerImage),Selection.refresh()}var docOffset,options=$.extend({},$.Jcrop.defaults),_ua=navigator.userAgent.toLowerCase(),is_msie=/msie/.test(_ua),ie6mode=/msie [1-6]\./.test(_ua);"object"!=typeof obj&&(obj=$(obj)[0]),"object"!=typeof opt&&(opt={}),setOptions(opt);var img_css={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},$origimg=$(obj),img_mode=!0;if("IMG"==obj.tagName){if(0!=$origimg[0].width&&0!=$origimg[0].height)$origimg.width($origimg[0].width),$origimg.height($origimg[0].height);else{var tempImage=new Image;tempImage.src=$origimg[0].src,$origimg.width(tempImage.width),$origimg.height(tempImage.height)}var $img=$origimg.clone().removeAttr("id").css(img_css).show();$img.width($origimg.width()),$img.height($origimg.height()),$origimg.after($img).hide()}else $img=$origimg.css(img_css).show(),img_mode=!1,null===options.shade&&(options.shade=!0);presize($img,options.boxWidth,options.boxHeight);var boundx=$img.width(),boundy=$img.height(),$div=$("<div />").width(boundx).height(boundy).addClass(cssClass("holder")).css({position:"relative",backgroundColor:options.bgColor}).insertAfter($origimg).append($img);options.addClass&&$div.addClass(options.addClass);var $img2=$("<div />"),$img_holder=$("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),$hdl_holder=$("<div />").width("100%").height("100%").css("zIndex",320),$sel=$("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var c=Coords.getFixed();options.onDblClick.call(api,c)}).insertBefore($img).append($img_holder,$hdl_holder);img_mode&&($img2=$("<img />").attr("src",$img.attr("src")).css(img_css).width(boundx).height(boundy),$img_holder.append($img2)),ie6mode&&$sel.css({overflowY:"hidden"});var xlimit,ylimit,xmin,ymin,xscale,yscale,btndown,animating,shift_down,bound=options.boundary,$trk=newTracker().width(boundx+2*bound).height(boundy+2*bound).css({position:"absolute",top:px(-bound),left:px(-bound),zIndex:290}).mousedown(newSelection),bgcolor=options.bgColor,bgopacity=options.bgOpacity;docOffset=getPos($img);var Touch=function(){function hasTouchSupport(){var i,support={},events=["touchstart","touchmove","touchend"],el=document.createElement("div");try{for(i=0;i<events.length;i++){var eventName=events[i];eventName="on"+eventName;var isSupported=eventName in el;isSupported||(el.setAttribute(eventName,"return;"),isSupported="function"==typeof el[eventName]),support[events[i]]=isSupported}return support.touchstart&&support.touchend&&support.touchmove}catch(err){return!1}}function detectSupport(){return options.touchSupport===!0||options.touchSupport===!1?options.touchSupport:hasTouchSupport()}return{createDragger:function(ord){return function(e){return!options.disabled&&(!("move"===ord&&!options.allowMove)&&(docOffset=getPos($img),btndown=!0,startDragMode(ord,mouseAbs(Touch.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1))}},newSelection:function(e){return newSelection(Touch.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:hasTouchSupport,support:detectSupport()}}(),Coords=function(){function setPressed(pos){pos=rebound(pos),x2=x1=pos[0],y2=y1=pos[1]}function setCurrent(pos){pos=rebound(pos),ox=pos[0]-x2,oy=pos[1]-y2,x2=pos[0],y2=pos[1]}function getOffset(){return[ox,oy]}function moveOffset(offset){var ox=offset[0],oy=offset[1];0>x1+ox&&(ox-=ox+x1),0>y1+oy&&(oy-=oy+y1),boundy<y2+oy&&(oy+=boundy-(y2+oy)),boundx<x2+ox&&(ox+=boundx-(x2+ox)),x1+=ox,x2+=ox,y1+=oy,y2+=oy}function getCorner(ord){var c=getFixed();switch(ord){case"ne":return[c.x2,c.y];case"nw":return[c.x,c.y];case"se":return[c.x2,c.y2];case"sw":return[c.x,c.y2]}}function getFixed(){if(!options.aspectRatio)return getRect();var xx,yy,w,h,aspect=options.aspectRatio,min_x=options.minSize[0]/xscale,max_x=options.maxSize[0]/xscale,max_y=options.maxSize[1]/yscale,rw=x2-x1,rh=y2-y1,rwa=Math.abs(rw),rha=Math.abs(rh),real_ratio=rwa/rha;return 0===max_x&&(max_x=10*boundx),0===max_y&&(max_y=10*boundy),real_ratio<aspect?(yy=y2,w=rha*aspect,xx=rw<0?x1-w:w+x1,xx<0?(xx=0,h=Math.abs((xx-x1)/aspect),yy=rh<0?y1-h:h+y1):xx>boundx&&(xx=boundx,h=Math.abs((xx-x1)/aspect),yy=rh<0?y1-h:h+y1)):(xx=x2,h=rwa/aspect,yy=rh<0?y1-h:y1+h,yy<0?(yy=0,w=Math.abs((yy-y1)*aspect),xx=rw<0?x1-w:w+x1):yy>boundy&&(yy=boundy,w=Math.abs(yy-y1)*aspect,xx=rw<0?x1-w:w+x1)),xx>x1?(xx-x1<min_x?xx=x1+min_x:xx-x1>max_x&&(xx=x1+max_x),yy=yy>y1?y1+(xx-x1)/aspect:y1-(xx-x1)/aspect):xx<x1&&(x1-xx<min_x?xx=x1-min_x:x1-xx>max_x&&(xx=x1-max_x),yy=yy>y1?y1+(x1-xx)/aspect:y1-(x1-xx)/aspect),xx<0?(x1-=xx,xx=0):xx>boundx&&(x1-=xx-boundx,xx=boundx),yy<0?(y1-=yy,yy=0):yy>boundy&&(y1-=yy-boundy,yy=boundy),makeObj(flipCoords(x1,y1,xx,yy))}function rebound(p){return p[0]<0&&(p[0]=0),p[1]<0&&(p[1]=0),p[0]>boundx&&(p[0]=boundx),p[1]>boundy&&(p[1]=boundy),[Math.round(p[0]),Math.round(p[1])]}function flipCoords(x1,y1,x2,y2){var xa=x1,xb=x2,ya=y1,yb=y2;return x2<x1&&(xa=x2,xb=x1),y2<y1&&(ya=y2,yb=y1),[xa,ya,xb,yb]}function getRect(){var delta,xsize=x2-x1,ysize=y2-y1;return xlimit&&Math.abs(xsize)>xlimit&&(x2=xsize>0?x1+xlimit:x1-xlimit),ylimit&&Math.abs(ysize)>ylimit&&(y2=ysize>0?y1+ylimit:y1-ylimit),ymin/yscale&&Math.abs(ysize)<ymin/yscale&&(y2=ysize>0?y1+ymin/yscale:y1-ymin/yscale),xmin/xscale&&Math.abs(xsize)<xmin/xscale&&(x2=xsize>0?x1+xmin/xscale:x1-xmin/xscale),x1<0&&(x2-=x1,x1-=x1),y1<0&&(y2-=y1,y1-=y1),x2<0&&(x1-=x2,x2-=x2),y2<0&&(y1-=y2,y2-=y2),x2>boundx&&(delta=x2-boundx,x1-=delta,x2-=delta),y2>boundy&&(delta=y2-boundy,y1-=delta,y2-=delta),x1>boundx&&(delta=x1-boundy,y2-=delta,y1-=delta),y1>boundy&&(delta=y1-boundy,y2-=delta,y1-=delta),makeObj(flipCoords(x1,y1,x2,y2))}function makeObj(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var ox,oy,x1=0,y1=0,x2=0,y2=0;return{flipCoords:flipCoords,setPressed:setPressed,setCurrent:setCurrent,getOffset:getOffset,moveOffset:moveOffset,getCorner:getCorner,getFixed:getFixed}}(),Shade=function(){function resizeShades(w,h){shades.left.css({height:px(h)}),shades.right.css({height:px(h)})}function updateAuto(){return updateShade(Coords.getFixed())}function updateShade(c){shades.top.css({left:px(c.x),width:px(c.w),height:px(c.y)}),shades.bottom.css({top:px(c.y2),left:px(c.x),width:px(c.w),height:px(boundy-c.y2)}),shades.right.css({left:px(c.x2),width:px(boundx-c.x2)}),shades.left.css({width:px(c.x)})}function createShade(){return $("<div />").css({position:"absolute",backgroundColor:options.shadeColor||options.bgColor}).appendTo(holder)}function enableShade(){enabled||(enabled=!0,holder.insertBefore($img),updateAuto(),Selection.setBgOpacity(1,0,1),$img2.hide(),setBgColor(options.shadeColor||options.bgColor,1),Selection.isAwake()?setOpacity(options.bgOpacity,1):setOpacity(1,1))}function setBgColor(color,now){colorChangeMacro(getShades(),color,now)}function disableShade(){enabled&&(holder.remove(),$img2.show(),enabled=!1,Selection.isAwake()?Selection.setBgOpacity(options.bgOpacity,1,1):(Selection.setBgOpacity(1,1,1),Selection.disableHandles()),colorChangeMacro($div,0,1))}function setOpacity(opacity,now){enabled&&(options.bgFade&&!now?holder.animate({opacity:1-opacity},{queue:!1,duration:options.fadeTime}):holder.css({opacity:1-opacity}))}function refreshAll(){options.shade?enableShade():disableShade(),Selection.isAwake()&&setOpacity(options.bgOpacity)}function getShades(){return holder.children()}var enabled=!1,holder=$("<div />").css({position:"absolute",zIndex:240,opacity:0}),shades={top:createShade(),left:createShade().height(boundy),right:createShade().height(boundy),bottom:createShade()};return{update:updateAuto,updateRaw:updateShade,getShades:getShades,setBgColor:setBgColor,enable:enableShade,disable:disableShade,resize:resizeShades,refresh:refreshAll,opacity:setOpacity}}(),Selection=function(){function insertBorder(type){var jq=$("<div />").css({position:"absolute",opacity:options.borderOpacity}).addClass(cssClass(type));return $img_holder.append(jq),jq}function dragDiv(ord,zi){var jq=$("<div />").mousedown(createDragger(ord)).css({cursor:ord+"-resize",position:"absolute",zIndex:zi}).addClass("ord-"+ord);return Touch.support&&jq.bind("touchstart.jcrop",Touch.createDragger(ord)),$hdl_holder.append(jq),jq}function insertHandle(ord){var hs=options.handleSize,div=dragDiv(ord,hdep++).css({opacity:options.handleOpacity}).addClass(cssClass("handle"));return hs&&div.width(hs).height(hs),div}function insertDragbar(ord){return dragDiv(ord,hdep++).addClass("jcrop-dragbar")}function createDragbars(li){var i;for(i=0;i<li.length;i++)dragbar[li[i]]=insertDragbar(li[i])}function createBorders(li){var cl,i;for(i=0;i<li.length;i++){switch(li[i]){case"n":cl="hline";break;case"s":cl="hline bottom";break;case"e":cl="vline right";break;case"w":cl="vline"}borders[li[i]]=insertBorder(cl)}}function createHandles(li){var i;for(i=0;i<li.length;i++)handle[li[i]]=insertHandle(li[i])}function moveto(x,y){options.shade||$img2.css({top:px(-y),left:px(-x)}),$sel.css({top:px(y),left:px(x)})}function resize(w,h){$sel.width(Math.round(w)).height(Math.round(h))}function refresh(){var c=Coords.getFixed();Coords.setPressed([c.x,c.y]),Coords.setCurrent([c.x2,c.y2]),updateVisible()}function updateVisible(select){if(awake)return update(select)}function update(select){var c=Coords.getFixed();resize(c.w,c.h),moveto(c.x,c.y),options.shade&&Shade.updateRaw(c),awake||show(),select?options.onSelect.call(api,unscale(c)):options.onChange.call(api,unscale(c))}function setBgOpacity(opacity,force,now){(awake||force)&&(options.bgFade&&!now?$img.animate({opacity:opacity},{queue:!1,duration:options.fadeTime}):$img.css("opacity",opacity))}function show(){$sel.show(),options.shade?Shade.opacity(bgopacity):setBgOpacity(bgopacity,!0),awake=!0}function release(){disableHandles(),$sel.hide(),options.shade?Shade.opacity(1):setBgOpacity(1),awake=!1,options.onRelease.call(api)}function showHandles(){seehandles&&$hdl_holder.show()}function enableHandles(){if(seehandles=!0,options.allowResize)return $hdl_holder.show(),!0}function disableHandles(){seehandles=!1,$hdl_holder.hide()}function animMode(v){v?(animating=!0,disableHandles()):(animating=!1,enableHandles())}function done(){animMode(!1),refresh()}var awake,hdep=370,borders={},handle={},dragbar={},seehandles=!1;options.dragEdges&&$.isArray(options.createDragbars)&&createDragbars(options.createDragbars),$.isArray(options.createHandles)&&createHandles(options.createHandles),options.drawBorders&&$.isArray(options.createBorders)&&createBorders(options.createBorders),$(document).bind("touchstart.jcrop-ios",function(e){$(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var $track=newTracker().mousedown(createDragger("move")).css({cursor:"move",position:"absolute",zIndex:360});return Touch.support&&$track.bind("touchstart.jcrop",Touch.createDragger("move")),$img_holder.append($track),disableHandles(),{updateVisible:updateVisible,update:update,release:release,refresh:refresh,isAwake:function(){return awake},setCursor:function(cursor){$track.css("cursor",cursor)},enableHandles:enableHandles,enableOnly:function(){seehandles=!0},showHandles:showHandles,disableHandles:disableHandles,animMode:animMode,setBgOpacity:setBgOpacity,done:done}}(),Tracker=function(){function toFront(touch){$trk.css({zIndex:450}),touch?$(document).bind("touchmove.jcrop",trackTouchMove).bind("touchend.jcrop",trackTouchEnd):trackDoc&&$(document).bind("mousemove.jcrop",trackMove).bind("mouseup.jcrop",trackUp)}function toBack(){$trk.css({zIndex:290}),$(document).unbind(".jcrop")}function trackMove(e){return onMove(mouseAbs(e)),!1}function trackUp(e){return e.preventDefault(),e.stopPropagation(),btndown&&(btndown=!1,onDone(mouseAbs(e)),Selection.isAwake()&&options.onSelect.call(api,unscale(Coords.getFixed())),toBack(),onMove=function(){},onDone=function(){}),!1}function activateHandlers(move,done,touch){return btndown=!0,onMove=move,onDone=done,toFront(touch),!1}function trackTouchMove(e){return onMove(mouseAbs(Touch.cfilter(e))),!1}function trackTouchEnd(e){return trackUp(Touch.cfilter(e))}function setCursor(t){$trk.css("cursor",t)}var onMove=function(){},onDone=function(){},trackDoc=options.trackDocument;return trackDoc||$trk.mousemove(trackMove).mouseup(trackUp).mouseout(trackUp),$img.before($trk),{activateHandlers:activateHandlers,setCursor:setCursor}}(),KeyManager=function(){function watchKeys(){options.keySupport&&($keymgr.show(),$keymgr.focus())}function onBlur(e){$keymgr.hide()}function doNudge(e,x,y){options.allowMove&&(Coords.moveOffset([x,y]),Selection.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function parseKey(e){if(e.ctrlKey||e.metaKey)return!0;shift_down=!!e.shiftKey;var nudge=shift_down?10:1;switch(e.keyCode){case 37:doNudge(e,-nudge,0);break;case 39:doNudge(e,nudge,0);break;case 38:doNudge(e,0,-nudge);break;case 40:doNudge(e,0,nudge);break;case 27:options.allowSelect&&Selection.release();break;case 9:return!0}return!1}var $keymgr=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),$keywrap=$("<div />").css({position:"absolute",overflow:"hidden"}).append($keymgr);return options.keySupport&&($keymgr.keydown(parseKey).blur(onBlur),ie6mode||!options.fixedSupport?($keymgr.css({position:"absolute",left:"-20px"}),$keywrap.append($keymgr).insertBefore($img)):$keymgr.insertBefore($img)),{watchKeys:watchKeys}}();Touch.support&&$trk.bind("touchstart.jcrop",Touch.newSelection),$hdl_holder.hide(),interfaceUpdate(!0);var api={setImage:setImage,animateTo:animateTo,setSelect:setSelect,setOptions:setOptionsNew,tellSelect:tellSelect,tellScaled:tellScaled,setClass:setClass,disable:disableCrop,enable:enableCrop,cancel:cancelCrop,release:Selection.release,destroy:destroy,focus:KeyManager.watchKeys,getBounds:function(){return[boundx*xscale,boundy*yscale]},getWidgetSize:function(){return[boundx,boundy]},getScaleFactor:function(){return[xscale,yscale]},getOptions:function(){return options},ui:{holder:$div,selection:$sel}};return is_msie&&$div.bind("selectstart",function(){return!1}),$origimg.data("Jcrop",api),api},$.fn.Jcrop=function(options,callback){var api;return this.each(function(){if($(this).data("Jcrop")){if("api"===options)return $(this).data("Jcrop");$(this).data("Jcrop").setOptions(options)}else"IMG"==this.tagName?$.Jcrop.Loader(this,function(){$(this).css({display:"block",visibility:"hidden"}),api=$.Jcrop(this,options),$.isFunction(callback)&&callback.call(api)}):($(this).css({display:"block",visibility:"hidden"}),api=$.Jcrop(this,options),$.isFunction(callback)&&callback.call(api))}),this},$.Jcrop.Loader=function(imgobj,success,error){function completeCheck(){img.complete?($img.unbind(".jcloader"),$.isFunction(success)&&success.call(img)):window.setTimeout(completeCheck,50)}var $img=$(imgobj),img=$img[0];$img.bind("load.jcloader",completeCheck).bind("error.jcloader",function(e){$img.unbind(".jcloader"),$.isFunction(error)&&error.call(img)}),img.complete&&$.isFunction(success)&&($img.unbind(".jcloader"),success.call(img))},$.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),function(jQuery,undefined){function clamp(value,prop,alwaysAllowEmpty){var type=propTypes[prop.type]||{};return(prop.empty||alwaysAllowEmpty)&&null==value?null:prop.def&&null==value?prop.def:(value=type.floor?~~value:parseFloat(value),null==value||isNaN(value)?prop.def:type.mod?(value%=type.mod,
value<0?type.mod+value:value):type.min>value?type.min:type.max<value?type.max:value)}function stringParse(string){var inst=color(),rgba=inst._rgba=[];return string=string.toLowerCase(),each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba",cache=spaces[spaceName].cache;if(values)return parsed=inst[spaceName](values),inst[cache]=parsed[cache],rgba=inst._rgba=parsed._rgba,!1}),0!==rgba.length?(0===Math.max.apply(Math,rgba)&&jQuery.extend(rgba,colors.transparent),inst):(string=colors[string])?string:void 0}function hue2rgb(p,q,h){return h=(h+1)%1,6*h<1?p+6*(q-p)*h:2*h<1?q:3*h<2?p+(q-p)*(2/3-h)*6:p}var colors,stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],execResult[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]]}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha)},spaces={rgba:{cache:"_rgba",props:{red:{idx:0,type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},propTypes={byte:{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},rgbaspace=spaces.rgba.props,support=color.support={},each=jQuery.each;spaces.hsla.props.alpha=rgbaspace.alpha,color.fn=color.prototype={constructor:color,parse:function(red,green,blue,alpha){if(void 0===red)return this._rgba=[null,null,null,null],this;(red instanceof jQuery||red.nodeType)&&(red=red instanceof jQuery?red.css(green):jQuery(red).css(green),green=void 0);var inst=this,type=jQuery.type(red),rgba=this._rgba=[];return void 0!==green&&(red=[red,green,blue,alpha],type="array"),"string"===type?this.parse(stringParse(red)||colors._default):"array"===type?(each(rgbaspace,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop)}),this):"object"===type?(red instanceof color?each(spaces,function(spaceName,space){red[space.cache]&&(inst[space.cache]=red[space.cache].slice())}):each(spaces,function(spaceName,space){each(space.props,function(key,prop){var cache=space.cache;if(!inst[cache]&&space.to){if(null==red[key]||"alpha"===key)return;inst[cache]=space.to(inst._rgba)}inst[cache][prop.idx]=clamp(red[key],prop,!0)})}),this):void 0},is:function(compare){var is=color(compare),same=!0,myself=this;return each(spaces,function(_,space){var localCache,isCache=is[space.cache];return isCache&&(localCache=myself[space.cache]||space.to&&space.to(myself._rgba)||[],each(space.props,function(_,prop){if(null!=isCache[prop.idx])return same=isCache[prop.idx]===localCache[prop.idx]})),same}),same},_space:function(){var used=[],inst=this;return each(spaces,function(spaceName,space){inst[space.cache]&&used.push(spaceName)}),used.pop()},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],start=this[space.cache]||space.to(this._rgba),result=start.slice();return end=end[space.cache],each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};null!==endValue&&(null===startValue?result[index]=endValue:(type.mod&&(endValue-startValue>type.mod/2?startValue+=type.mod:startValue-endValue>type.mod/2&&(startValue-=type.mod)),result[prop.idx]=clamp((endValue-startValue)*distance+startValue,prop)))}),this[spaceName](result)},blend:function(opaque){if(1===this._rgba[3])return this;var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v}))},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return null==v?i>2?1:0:v});return 1===rgba[3]&&(rgba.pop(),prefix="rgb("),prefix+rgba.join(",")+")"},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){return null==v&&(v=i>2?1:0),i&&i<3&&(v=Math.round(100*v)+"%"),v});return 1===hsla[3]&&(hsla.pop(),prefix="hsl("),prefix+hsla.join(",")+")"},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();return includeAlpha&&rgba.push(~~(255*alpha)),"#"+jQuery.map(rgba,function(v,i){return v=(v||0).toString(16),1===v.length?"0"+v:v}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}},color.fn.parse.prototype=color.fn,spaces.hsla.to=function(rgba){if(null==rgba[0]||null==rgba[1]||null==rgba[2])return[null,null,null,rgba[3]];var h,s,r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=.5*add;return h=min===max?0:r===max?60*(g-b)/diff+360:g===max?60*(b-r)/diff+120:60*(r-g)/diff+240,s=0===l||1===l?l:l<=.5?diff/add:diff/(2-add),[Math.round(h)%360,s,l,null==a?1:a]},spaces.hsla.from=function(hsla){if(null==hsla[0]||null==hsla[1]||null==hsla[2])return[null,null,null,hsla[3]];var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(255*hue2rgb(p,q,h+1/3)),Math.round(255*hue2rgb(p,q,h)),Math.round(255*hue2rgb(p,q,h-1/3)),a]},each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]&&(this[cache]=to(this._rgba)),void 0===value)return this[cache].slice();var ret,type=jQuery.type(value),arr="array"===type||"object"===type?value:arguments,local=this[cache].slice();return each(props,function(key,prop){var val=arr["object"===type?key:prop.idx];null==val&&(val=local[prop.idx]),local[prop.idx]=clamp(val,prop)}),from?(ret=color(from(local)),ret[cache]=local,ret):color(local)},each(props,function(key,prop){color.fn[key]||(color.fn[key]=function(value){var match,vtype=jQuery.type(value),fn="alpha"===key?this._hsla?"hsla":"rgba":spaceName,local=this[fn](),cur=local[prop.idx];return"undefined"===vtype?cur:("function"===vtype&&(value=value.call(this,cur),vtype=jQuery.type(value)),null==value&&prop.empty?this:("string"===vtype&&(match=rplusequals.exec(value))&&(value=cur+parseFloat(match[2])*("+"===match[1]?1:-1)),local[prop.idx]=value,this[fn](local)))})})}),each(stepHooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,backgroundColor,curElem;if("string"!==jQuery.type(value)||(parsed=stringParse(value))){if(value=color(parsed||value),!support.rgba&&1!==value._rgba[3]){curElem="backgroundColor"===hook?elem.parentNode:elem;do backgroundColor=jQuery.curCSS(curElem,"backgroundColor");while((""===backgroundColor||"transparent"===backgroundColor)&&(curElem=curElem.parentNode)&&curElem.style);value=value.blend(backgroundColor&&"transparent"!==backgroundColor?backgroundColor:"_default")}value=value.toRgbaString()}elem.style[hook]=value}},jQuery.fx.step[hook]=function(fx){fx.colorInit||(fx.start=color(fx.elem,hook),fx.end=color(fx.end),fx.colorInit=!0),jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos))}}),jQuery(function(){var div=document.createElement("div"),div_style=div.style;div_style.cssText="background-color:rgba(1,1,1,.5)",support.rgba=div_style.backgroundColor.indexOf("rgba")>-1}),colors=jQuery.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery);